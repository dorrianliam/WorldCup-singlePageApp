webpackJsonp([11],{109:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var i=function(e,t,n,i,o,s){var a=i,r={eventCategory:"media",eventAction:o(e),eventLabel:n,dimension19:s,dimension20:a},c=t[e.eventType];return c&&(r[c]=1),r},o=function(e){var t=e.mediaType+" ";return e.isPreroll?t+="preroll":t+="content",t}},198:function(e,t,n){var i,o;i=[n(29),n(25),n(6)],void 0!==(o=function(e,t,n){var i={leading:!1,maxWait:0,trailing:!1};return function(o,s,a){var r=!0,c=!0;if(!t(o))throw new TypeError;return!1===a?r=!1:n(a)&&(r="leading"in a?a.leading:r,c="trailing"in a?a.trailing:c),i.leading=r,i.maxWait=s,i.trailing=c,e(o,s,i)}}.apply(t,i))&&(e.exports=o)},199:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return a});var i=n(106),o=function(e){Object.keys(e).forEach(function(t){i.a.set("accessibility."+t,e[t])})},s=function(e){return!1!==i.a.get("accessibility."+e)},a=function(e){return!0===s(e)}},207:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(27),o=n.n(i),s=n(193),a=new Promise(function(e){window.YT&&window.YT.Player?e():window.onYouTubeIframeAPIReady=e}),r=function(){Object(s.a)("https://www.youtube.com/iframe_api",{})},c=function(e){e.classList.add("youtube__video-started")},l=function(e,t,n){o.a.write(function(){["ENDED","PLAYING","PAUSED","BUFFERING","CUED"].forEach(function(t){n.classList.toggle("youtube__video-"+t.toLocaleLowerCase(),e.data===window.YT.PlayerState[t])}),c(n)}),t&&"function"==typeof t.onPlayerStateChange&&t.onPlayerStateChange(e)},u=function(e,t,n){o.a.write(function(){n.classList.add("youtube__video-ready")}),t&&"function"==typeof t.onPlayerReady&&t.onPlayerReady(e)},d=function(e,t,n){return new window.YT.Player(e,{events:{onReady:t,onStateChange:n}})},m=function(e){return e.target.getCurrentTime()>0},h=function(e,t,n){return r(),a.then(function(){return d(n,function(n){m(n)&&c(e),u(n,t,e)},function(n){l(n,t,e)})})}},208:function(e,t,n){"use strict";n.d(t,"b",function(){return u}),n.d(t,"a",function(){return l});var i=n(7),o=n(0),s=n(30),a=n.n(s),r=n(109),c=function(e,t){return e+":"+t},l=function(e){var t=o.a.get("googleAnalytics.trackers.editorial"),n={metricMap:{play:"metric1",skip:"metric2",25:"metric3",50:"metric4",75:"metric5",end:"metric6"},baseEventObject:{eventCategory:"media",eventAction:"video content",eventLabel:e,dimension19:e,dimension20:"gu-video-youtube"}},s=function(e){var t={video:{id:"gu-video-youtube-"+e.mediaId,eventType:"video:content:"+e.eventType}};a.a.record(t)};["play","25","50","75","end"].forEach(function(o){i.a.once(c(o,e),function(i){var a={mediaId:e,mediaType:"video",eventType:o,isPreroll:!1};s(a),window.ga(t+".send","event",Object(r.a)(a,n.metricMap,i,"gu-video-youtube",function(){return"video content"},e))})})},u=function(e,t){i.a.emit(c(e,t),t)}},225:function(e,t,n){"use strict";n.d(t,"a",function(){return E}),n.d(t,"b",function(){return T});var i=n(27),o=n.n(i),s=n(207),a=n(208),r=n(35),c=n(41),l=n(0),u=n(22),d=n(29),m=n.n(d),h=n(199),f={},p=function(e){return e.split("/")[0]},g=function(e){var t=f[e].player,n=f[e].pendingTrackingCalls;if(n.length){t.duration||(t.duration=t.getDuration());var i=t.getCurrentTime();Math.round(i/t.duration*100)>=n[0]&&(Object(a.b)(n[0],p(e)),n.shift())}},v=function(e){f[e].progressTracker&&clearInterval(f[e].progressTracker)},b=function(e){return f[e].progressTracker=setInterval(g.bind(null,e),1e3),f[e].progressTracker},y={ENDED:function(e){var t=f[e];v(e),Object(a.b)("end",p(e)),t.pendingTrackingCalls=[25,50,75];var n=t.iframe&&t.iframe.closest(".immersive-main-media")||null;n&&n.classList.remove("atom-playing")},PLAYING:function(e){var t=f[e];if(t){v(e),b(e),Object(a.b)("play",p(e));var n=t.iframe&&t.iframe.closest(".immersive-main-media")||null,i=t.overlay&&t.overlay.parentNode,o=i&&i.querySelector(".end-slate-container");n&&n.classList.add("atom-playing"),t.endSlate&&!o&&t.endSlate.fetch(i,"html")}},PAUSED:function(e){return v(e)}},w=function(e,t,n){t===window.YT.PlayerState[n]&&y[n]&&y[n](e)},C=function(e){return"Video"===l.a.get("page.contentType")&&(l.a.get("page.isDev")?0===document.referrer.indexOf(window.location.origin):0===document.referrer.indexOf(l.a.get("page.host")))&&!(Object(u.n)()||Object(u.k)())&&(f[e].iframe&&f[e].iframe.closest('figure[data-component="main video"]')||!1)&&Object(h.a)("flashing-elements")},j=function(e){var t=e.parentNode;if(t instanceof HTMLElement){var n=(t.dataset||{}).endSlate;if(n){var i=new r.a;return i.endpoint=n,i}}else;},k=function(){var e=document.querySelector(".immersive-main-media__media .youtube-media-atom"),t=e?e.offsetHeight:0,n=document.querySelector(".immersive-main-media__headline-container"),i=t-(n?n.offsetHeight:0),o=document.querySelector(".youtube-media-atom__immersive-interface");o&&(o.style.top=i+"px")},_=function(e,t,n,i){f[e]={player:i.target,pendingTrackingCalls:[25,50,75],iframe:n},C(e)&&i.target.playVideo(),t&&(f[e].overlay=t,l.a.page.section&&Object(u.l)({min:"desktop"})&&(f[e].endSlate=j(t))),n&&n.closest(".immersive-main-media__media")&&(k(),window.addEventListener("resize",m()(k.bind(null),200)))},O=function(e,t){return Object.keys(y).forEach(w.bind(null,e,t.data))},x=function(e){e&&o.a.read(function(){Object(c.a)(".youtube-media-atom",e).each(function(e,t){var n=e.querySelector("iframe");if(n){n.id+="/"+t;var i=e.getAttribute("data-media-atom-id")+"/"+t;e.setAttribute("data-unique-atom-id",i);var o=e.querySelector(".youtube-media-atom__overlay");Object(a.a)(p(i)),Object(s.a)(n,{onPlayerReady:_.bind(null,i,o,n),onPlayerStateChange:O.bind(null,i)},n.id)}})})},E=function(e){e&&e.length?e.forEach(x):x(document.body)},T=function(e){var t=f[e];t&&t.player.pauseVideo()}},378:function(e,t,n){var i,o;i=[n(25)],void 0!==(o=function(e){return function(t){var n,i;if(!e(t))throw new TypeError;return function(){return n?i:(n=!0,i=t.apply(this,arguments),t=null,i)}}}.apply(t,i))&&(e.exports=o)},391:function(e,t,n){"use strict";n.d(t,"c",function(){return a}),n.d(t,"d",function(){return r}),n.d(t,"e",function(){return c}),n.d(t,"b",function(){return l}),n.d(t,"g",function(){return u}),n.d(t,"f",function(){return d}),n.d(t,"a",function(){return m});var i=n(121),o=n(0),s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(o.a.get("switches.enableDiscussionSwitch"))return Object(i.a)({url:o.a.get("page.discussionApiUrl")+e,type:"get"===t?"jsonp":"json",method:t,crossOrigin:!0,data:n,headers:{"D2-X-UID":o.a.get("page.discussionD2Uid"),"GU-Client":o.a.get("page.discussionApiClientHeader")},withCredentials:!0});throw new Error("Discussion features have been disabled")},a=function(e,t){var n="/discussion/"+e+"/comment"+(t.replyTo?"/"+t.replyTo.commentId+"/reply":"");return s(n,"post",t)},r=function(e){return s("/comment/preview","post",e)},c=function(e){return s("/comment/"+e+"/recommend","post")},l=function(e){return s("/comment/"+e+"/highlight","post")},u=function(e){return s("/comment/"+e+"/unhighlight","post")},d=function(e,t){return s("/comment/"+e+"/reportAbuse","post",t)},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";return s("/profile/"+e,"get")}},407:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(7),c=n(27),l=n.n(c),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o()(this,e),this.element=t,this.opts=Object.assign({},{top:0,containInParent:!0,emitMessage:!1},n)}return a()(e,[{key:"init",value:function(){var e=this,t=this.element.parentElement;t&&(l.a.read(function(){e.offsetFromParent=e.element.getBoundingClientRect().top-t.getBoundingClientRect().top},this),r.a.on("window:throttledScroll",this.updatePosition.bind(this)),l.a.read(this.updatePosition,this))}},{key:"updatePosition",value:function(){var e=this,t=this.element.parentElement;if(t){var n=this.element.getBoundingClientRect(),i=t.getBoundingClientRect(),o=n.height,s=void 0,a=void 0,r=void 0;if(i.top+this.offsetFromParent>0)r=!1,s={top:""},a="unfixed";else{r=!0;var c=this.opts.containInParent&&i.bottom<=n.height?Math.floor(i.bottom-o-this.opts.top):this.opts.top;s={top:c+"px"},a="fixed"}this.opts.emitMessage&&a&&a!==this.lastMessage&&(this.emitMessage(a),this.lastMessage=a),s&&l.a.write(function(){r?e.element.classList.add("is-sticky"):e.element.classList.remove("is-sticky"),Object.assign(e.element.style,s)},this)}}},{key:"emitMessage",value:function(e){r.a.emit("modules:"+this.element.id+":"+e)}}]),e}()},424:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"initTrails",function(){return S});var i=n(33),o=n.n(i),s=n(72),a=n(34),r=n.n(a),c=n(41),l=n(0),u=n(192),d=n(450),m=n(500),h=n(96),f=n(507),p=n(819),g=n(820),v=n(822),b=n(823),y=n(826),w=n(827),C=function(){var e=l.a.get("page",{}),t=e.showRelatedContent,n=e.isPaidContent,i=e.section,o=e.shortUrl,s=e.seriesId;if(l.a.get("isMedia")&&t&&!n&&i){var a=Object(c.a)(".js-more-in-section")[0];Object(w.a)(a,l.a.get("page.contentType","").toLowerCase(),i,o,s)}},j=function(e,t){window.location.hash?t():s.a.read(function(){return document.querySelector(e)}).then(function(e){e&&Object(d.a)(e,1500,t)})},k=function(){l.a.get("page.isFront")||j(".js-popular-trails",function(){new p.a})},_=function(){l.a.get("page.seriesId")||l.a.get("page.blogIds")||j(".js-related",function(){var e={excludeTags:[]};"paid-content"!==l.a.get("page.sponsorshipType")&&e.excludeTags.push("tone/advertisement-features"),"contentType"in l.a.get("page")&&["video","interactive"].includes(l.a.page.contentType.toLowerCase())&&e.excludeTags.push("guardian-professional/guardian-professional"),Object(g.a)(e)})},O=function(){if(l.a.get("isMedia")){var e=l.a.get("page.contentType","").toLowerCase();Object(c.a)("video"===e?".js-video-components-container":".js-media-popular").each(function(t){Object(y.a)(t,e)})}},x=function(){j(".js-onward",function(){(l.a.get("page.seriesId")||l.a.get("page.blogIds"))&&l.a.get("page.showRelatedContent")?new f.a(r()(".js-onward")):""!==l.a.get("page.tones","")&&s.a.read(function(){return document.querySelectorAll(".js-onward")}).then(function(e){[].concat(o()(e)).forEach(function(e){(new v.a).fetch(e,"html")})})}),O()},E=function(){l.a.get("switches.enableDiscussionSwitch")&&l.a.get("page.commentable")&&s.a.read(function(){return document.querySelector(".discussion")}).then(function(e){e&&(new m.a).attachTo(e)})},T=function(){Object(h.g)()||s.a.read(function(){return Object(c.a)(".js-comments")}).then(function(e){return s.a.write(function(){if(e.appendTo(r()(".js-repositioned-comments")),"#comments"===window.location.hash){var t=e.offset().top;Object(c.a)(document.body).scrollTop(t)}})})},S=function(){Object(u.b)([["c-discussion",E],["c-comments",T],["c-shares",b.a],["c-popular",k],["c-related",_],["c-onward",x],["c-more-in-section",C]])}},425:function(e,t,n){"use strict";var i=n(121),o=n(0),s=o.a.page.avatarApiUrl+"/v1",a=o.a.page.avatarImagesUrl+"/user",r=function(e,t,n){var o={url:s+t,type:"json",data:n,processData:!1,method:e,crossOrigin:!0,withCredentials:!0};return Object(i.a)(o)};t.a={request:r,getActive:function(){return r("GET","/avatars/user/me/active")},updateAvatar:function(e){return r("POST","/avatars",e)},deterministicUrl:function(e){return a+"/"+e}}},441:function(e,t,n){"use strict";n.d(t,"a",function(){return y});var i=n(11),o=n.n(i),s=n(75),a=n.n(s),r=n(13),c=n.n(r),l=n(76),u=n.n(l),d=n(34),m=n.n(d),h=n(35),f=n(7),p=n(378),g=n.n(p),v=new Promise(function(e,t){f.a.on("modules:onward:geo-most-popular:ready",e),f.a.on("modules:onward:geo-most-popular:cancel",e),f.a.on("modules:onward:geo-most-popular:error",t)}),b=function(e){function t(){o()(this,t);var e=a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.endpoint="/most-read-geo.json",f.a.emit("register:begin","geo-most-popular"),e}return u()(t,e),c()(t,null,[{key:"error",value:function(e){f.a.emit("modules:onward:geo-most-popular:error",e)}}]),c()(t,[{key:"ready",value:function(){f.a.emit("register:end","geo-most-popular"),f.a.emit("modules:onward:geo-most-popular:ready",this)}}]),t}(h.a),y={render:g()(function(){return(new b).fetch(m()(".js-components-container"),"rightHtml"),v}),whenRendered:v}},446:function(e,t,n){"use strict";var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(168),c=function(){function e(t){o()(this,e),this.context=t.context,this.states=t.states||{},this.context.state=t.initial||"",this.debug=t.debug||!1,this.onChangeState=t.onChangeState.bind(this.context)||function(){}}return a()(e,[{key:"log",value:function(){if(this.debug&&window.console&&window.console.log){var e;(e=window.console).log.apply(e,arguments)}}},{key:"trigger",value:function(e,t){this.log("fsm: (event)",e);var n=this.context.state;(this.states[n].events[e]||r.a).call(this.context,t),(n!==this.context.state||this.context.reloadState)&&(this.context.reloadState=!1,this.onChangeState(n,this.context.state),(this.states[n].leave||r.a).apply(this.context),(this.states[this.context.state].enter||r.a).apply(this.context),this.log("fsm: (state)",n+" -> "+this.context.state))}}]),e}();t.a=c},450:function(e,t,n){"use strict";n.d(t,"a",function(){return f});var i=n(16),o=n.n(i),s=n(29),a=n.n(s),r=n(72),c=n(7),l=[],u={top:0,bottom:0},d=function e(){u.top=window.pageYOffset,u.bottom=u.top+o.a.viewport().height,0===(l=l.filter(function(e){return!e.conditionFn()||(e.loadFn(),!1)})).length&&c.a.off("window:throttledScroll",e)},m=a()(d,2e3),h=function(e,t){var n={conditionFn:e,loadFn:t};l.push(n),1===l.length&&c.a.on("window:throttledScroll",d),m()},f=function(e,t,n){r.a.read(function(){var i=o()(e);h(function(){var e=i.offset(),n=e.top-t,o=e.top+e.height+t;return u.top>n&&u.bottom<o},n)})}},451:function(e,t,n){"use strict";n.d(t,"a",function(){return j});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(75),c=n.n(r),l=n(76),u=n.n(l),d=n(42),m=n.n(d),h=n(16),f=n.n(h),p=n(7),g=n(35),v=n(391),b=n(96),y=n(452),w=n(453),C=n(502),j=function(e){function t(e){o()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.useBem=!0,n.templateName="comment-box",n.componentClass="d-comment-box",n.classes={},n.errors=[],n.defaultOptions={discussionId:null,apiRoot:null,maxLength:5e3,premod:!1,newCommenter:!1,hasUsername:!0,focus:!1,state:"top-level",replyTo:null,priorToVerificationDate:new Date(1392719401337)},n.errorMessages={EMPTY_COMMENT_BODY:"Please write a comment.",COMMENT_TOO_LONG:"Your comment must be fewer than 5000 characters long.",USER_BANNED:'Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).',IP_THROTTLED:'Commenting has been temporarily blocked for this IP address (<a href="/community-faqs">why?</a>).',DISCUSSION_CLOSED:"Sorry your comment can not be published as the discussion is now closed for comments.",PARENT_COMMENT_MODERATED:"Sorry the comment can not be published as the comment you replied to has been moderated since.",COMMENT_RATE_LIMIT_EXCEEDED:"You can only post one comment every minute. Please try again in a moment.",INVALID_PROTOCOL:"Sorry your comment can not be published as it was not sent over a secure channel. Please report us this issue using the technical issue link in the page footer.",AUTH_COOKIE_INVALID:"Sorry, your comment was not published as you are no longer signed in. Please sign in and try again.","READ-ONLY-MODE":"Sorry your comment can not currently be published as commenting is undergoing maintenance but will be back shortly. Please try again in a moment.",API_CORS_BLOCKED:"Could not post due to your internet settings, which might be\n                 controlled by your provider. Please contact your administrator\n                 or disable any proxy servers or VPNs and try again.",API_ERROR:"Sorry, there was a problem posting your comment. Please try\n                another browser or network connection.  Reference code ",EMAIL_VERIFIED:'<span class="d-comment-box__error-meta">Sent. Please check your\n                email to verify your email address. Once verified post your\n                comment.</span>',EMAIL_VERIFIED_FAIL:'We are having technical difficulties. Please try again later or\n                <a href="/send/email" class="js-id-send-validation-email">\n                <strong>resend the verification</strong></a>.',EMAIL_NOT_VALIDATED:'Please confirm your email address to comment.<br />\n                If you can\'t find the email, we can\n                <a href="_#" class="js-id-send-validation-email">\n                <strong>resend the verification email</strong></a> to your email\n                address.'},n.setOptions(e),p.a.on("module:identity:validation-email:success",function(){return n.verificationEmailSuccess()}),p.a.on("module:identity:validation-email:fail",function(){return n.verificationEmailFail()}),n}return u()(t,e),a()(t,[{key:"onboardingPreviewSuccess",value:function(e,t){var n=this.getElem("onboarding-preview-body");n&&(n.innerHTML=t.commentBody)}},{key:"getDiscussionId",value:function(){var e=this.options.discussionId,t=this.elem&&this.elem instanceof HTMLElement&&this.elem.getAttribute("data-discussion-key");return!e&&t&&(t=t.replace("discussion","")),e||t||""}},{key:"setFormState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getElem("body"),n=this.getElem("submit");n&&(e||0===t.value.length)?n.setAttribute("disabled","disabled"):n&&n.removeAttribute("disabled")}},{key:"setExpanded",value:function(){this.setState("expanded")}},{key:"getUserData",value:function(){return Object(b.d)()}},{key:"clearErrors",value:function(){var e=this.getElem("messages");e&&(e.innerHTML=""),this.errors=[],this.removeState("invalid")}},{key:"refreshUsernameHtml",value:function(){Object(b.h)();var e=this.getUserData().displayName,t=document.querySelector(".js-profile-info"),n=document.querySelector("._author_tywwu_16");t&&e&&(t.innerHTML=e),n&&e&&(n.innerHTML=e)}},{key:"previewCommentSuccess",value:function(e,t){var n=this.getElem("preview-body");n&&(n.innerHTML=t.commentBody),this.setState("preview-visible")}},{key:"fail",value:function(e){var t=void 0;try{t=JSON.parse(e.responseText)}catch(e){t={}}this.setFormState(),0===e.status?this.error("API_CORS_BLOCKED"):"EMAIL_NOT_VALIDATED"===t.errorCode?this.invalidEmailError():"IP_ADDRESS_BLOCKED"===t.errorCode?this.error("IP_THROTTLED"):this.errorMessages[t.errorCode]?this.error(t.errorCode):this.error("API_ERROR",this.errorMessages.API_ERROR+e.status)}},{key:"postCommentSuccess",value:function(e,t){this.refreshUsernameHtml(),this.options.newCommenter&&(this.options.newCommenter=!1);var n=this.getElem("body");e.id=parseInt(t.message,10),n.value="",this.resetPreviewComment(),this.setFormState(),this.emit("post:success",e),p.a.emit("discussion:commentbox:post:success",e)}},{key:"error",value:function(e,t){var n=this.getElem("messages");this.setState("invalid");var i='\n            <div class="d-discussion__error '+this.getClass("error",!0)+'">\n                <i class="i i-alert"></i>\n                <span class="d-discussion__error-text">\n                    '+(t||this.errorMessages[e])+"\n                </span>\n            </div>";n&&n.appendChild(f.a.create(i)[0]),this.errors.push(e)}},{key:"postComment",value:function(){var e=this,t={body:(this.elem&&this.elem instanceof HTMLFormElement&&this.elem.body instanceof HTMLTextAreaElement&&this.elem.body||{}).value};this.clearErrors();var n=function(){e.removeState("onboarding-visible"),t.body=Object(C.a)(t.body),e.setFormState(!0),Object(v.c)(e.getDiscussionId(),t).then(function(n){return e.postCommentSuccess(t,n)}).catch(function(t){return e.fail(t)})},i=function(t){var i=e.getElem("onboarding-username");p.a.emit("user:username:updated",t.user.publicFields.username),e.options.hasUsername=!0,i&&i.classList.add("is-hidden"),n()},o=function(t){var n=e.getElem("onboarding-username-input"),i=e.getElem("onboarding-username-error-message");e.setState("onboarding-visible"),n&&n.classList.add("d-comment-box__onboarding-username-error-border"),i&&(i.innerHTML=JSON.parse(t.responseText).errors[0].description,i.classList.remove("is-hidden"))},s=function(){if(""===t.body&&e.error("EMPTY_COMMENT_BODY"),t.body.length>e.options.maxLength&&e.error("COMMENT_TOO_LONG","<b>Comments must be shorter than "+e.options.maxLength+" characters.</b>Yours is currently "+(t.body.length-e.options.maxLength)+" character(s) too long."),e.options.replyTo&&(t.replyTo=e.options.replyTo),0===e.errors.length)if(e.options.newCommenter&&!e.options.hasUsername){var s=e.getElem("onboarding-username-input");Object(b.j)(s.value).then(i,o)}else n()};this.getUserData().emailVerified?s():new Date(this.getUserData().accountCreatedDate)>this.options.priorToVerificationDate?Object(b.c)().then(function(t){!0===t.user.statusFields.userEmailValidated?s():e.invalidEmailError()}):s()}},{key:"invalidEmailError",value:function(){this.removeState("onboarding-visible"),this.error("EMAIL_NOT_VALIDATED"),Object(w.a)()}},{key:"submitPostComment",value:function(e){e.preventDefault(),this.postComment()}},{key:"ready",value:function(){var e=this;if(null===this.getDiscussionId())throw new Error('CommentBox: You need to set the "data-discussion-key" on your element');var t=this.getElem("body");if(this.setFormState(),this.options.newCommenter?(m.a.on(document.body,"submit",[this.elem],function(t){return e.showOnboarding(t)}),m.a.on(document.body,"click",this.getClass("onboarding-cancel"),function(t){return e.hideOnboarding(t)})):m.a.on(document.body,"submit",[this.elem],function(t){return e.submitPostComment(t)}),m.a.on(document.body,"change keyup",[t],function(){return e.setFormState()}),m.a.on(t,"focus",function(){return e.setExpanded()}),this.on("change",".d-comment-box__body",function(){return e.resetPreviewComment()}),this.on("click",this.getClass("preview"),function(){return e.previewComment("previewCommentSuccess")}),this.on("click",this.getClass("hide-preview"),function(){return e.resetPreviewComment()}),this.on("click",this.getClass("cancel"),function(){return e.cancelComment()}),this.on("click",this.getClass("show-parent"),function(){return e.setState("parent-visible")}),this.on("click",this.getClass("hide-parent"),function(){return e.removeState("parent-visible")}),["bold","italic","quote","link"].forEach(function(t){var n=e.getClass("formatting-"+t);e.on("click",n,function(){return e.formatComment(t)})}),this.options.state&&this.setState(this.options.state),this.options.focus){var n=this.getElem("body");n&&window.setTimeout(function(){n.focus()},0)}}},{key:"hideOnboarding",value:function(e){e.preventDefault(),this.removeState("onboarding-visible")}},{key:"showOnboarding",value:function(e){if(e.preventDefault(),this.hasState("onboarding-visible")||!this.options.newCommenter)this.options.hasUsername&&this.removeState("onboarding-visible"),this.postComment();else{var t=this.getElem("onboarding-author"),n=this.getElem("onboarding-username");t&&(t.innerHTML=this.getUserData().displayName),this.setState("onboarding-visible"),this.previewComment("onboardingPreviewSuccess"),n&&this.options.hasUsername&&n.classList.add("is-hidden")}}},{key:"prerender",value:function(){var e=this;if(!this.options.premod){var t=this.getElem("premod");t&&t.parentNode&&t.parentNode.removeChild(t)}var n=this.getUserData(),i=this.getElem("author");if(i&&(i.innerHTML=n.displayName),"response"===this.options.state){var o=this.getElem("submit");o&&(o.innerHTML="Post reply")}else if(this.options.shouldRenderMainAvatar){var s=this.getElem("avatar-wrapper");s&&(s.setAttribute("userid",n.id),s.setAttribute("data-userid",n.id),Object(y.a)(s))}else{var a=document.getElementsByClassName("d-comment-box__meta")[0];a&&a.parentNode&&a.parentNode.removeChild(a)}if(this.options.replyTo){var r=this.getElem("reply-to-author"),c=this.getElem("parent-comment-body"),l=this.getElem("parent-comment-author"),u=this.options.replyTo||{},d=u.author,m=u.timestamp,h=u.body;r&&d&&(r.innerHTML=d),l&&d&&m&&(l.innerHTML=d+" @ "+m+" said:"),c&&h&&(c.innerHTML=h);var f=function(){var t=e.getElem("parent-comment-spout"),n=!!r&&r.offsetLeft+r.getBoundingClientRect().width/2;t&&n&&(t.style.marginLeft=n+"px")};window.setTimeout(function(){return f()},0)}}},{key:"verificationEmailSuccess",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED")}},{key:"verificationEmailFail",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED_FAIL")}},{key:"previewComment",value:function(e){var t=this,n={body:this.getElem("body").value},i=this[e].bind(this);if(this.clearErrors(),""===n.body&&(this.resetPreviewComment(),this.error("EMPTY_COMMENT_BODY")),n&&n.body&&n.body.length>this.options.maxLength){var o=n.body.length-this.options.maxLength,s="\n                <b>Comments must be shorter than\n                "+this.options.maxLength+" characters</b>. Yours is currently\n                "+o+" characters too long.";this.error("COMMENT_TOO_LONG",s)}0===this.errors.length&&Object(v.d)(n).then(function(e){return i(n,e)}).catch(function(e){return t.fail(e)})}},{key:"cancelComment",value:function(){if("response"===this.options.state)this.destroy();else{var e=this.getElem("body");this.resetPreviewComment(),e.value="",this.setFormState(),this.removeState("expanded")}}},{key:"resetPreviewComment",value:function(){var e=this.getElem("preview-body");this.removeState("preview-visible"),e&&(e.innerHTML="")}},{key:"formatComment",value:function(e){var t=this.getElem("body"),n=t.selectionStart,i=t.value.substring(t.selectionStart,t.selectionEnd),o=function(e){t.setSelectionRange(n,n+e.length)},s=function(e,n){var s=e+i+n;t.value=t.value.substring(0,t.selectionStart)+s+t.value.substring(t.selectionEnd),o(s)};switch(e){case"bold":s("<b>","</b>");break;case"italic":s("<i>","</i>");break;case"quote":s("<blockquote>","</blockquote>");break;case"link":!function(){var e=void 0,n=void 0;/^https?:\/\//i.test(i)?e=i:(e=n=window.prompt("Your URL:","http://www."),i=i||n);var o='<a href="'+e+'">'+i+"</a>";t.value=t.value.substring(0,t.selectionStart)+o+t.value.substring(t.selectionEnd)}()}}}]),t}(g.a)},452:function(e,t,n){"use strict";n.d(t,"b",function(){return d}),n.d(t,"a",function(){return u});var i=n(33),o=n.n(i),s=n(425),a=n(16),r=n.n(a),c=n(0),l=n(72),u=function(e){var t=r()(r.a.create('<div class="is-updating"></div>')),n=r()(r.a.create('<img class="user-avatar__image" alt="" />')),i=e.dataset.userid,o=c.a.get("user.id",null),a=function(t,n){t.remove(),n.appendTo(e)};e.classList.remove("is-hidden"),t.css("display","block").appendTo(e),i===o?s.a.getActive().then(function(e){n.attr("src",e.data.avatarUrl)}).catch(function(){var e=s.a.deterministicUrl(i);n.attr("src",e)}).always(function(){a(t,n)}):(n.attr("src",s.a.deterministicUrl(i)),a(t,n))},d=function(){return l.a.read(function(){return document.getElementsByClassName("user-avatar")}).then(function(e){e&&[].concat(o()(e)).forEach(u)})}},453:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(72),o=n(7),s=n(96),a=function(){i.a.read(function(){return document.getElementsByClassName("js-id-send-validation-email")}).then(function(e){if(e.length){var t=e[0];t.addEventListener("click",function(e){e.preventDefault(),Object(s.g)()&&Object(s.i)().then(function(e){if("error"===e.status)o.a.emit("module:identity:validation-email:fail"),i.a.write(function(){t.innerHTML="An error occured, please click here to try again."});else{o.a.emit("module:identity:validation-email:success");var n=t.parentNode;if(n){var s=document.createElement("p");s.innerText="Sent. Please check your email and follow the link.",i.a.write(function(){n.replaceChild(s,t)})}}},function(){o.a.emit("module:identity:validation-email:fail"),i.a.write(function(){t.innerHTML="An error occured, please click here to try again."})})})}})}},454:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"init",function(){return Y}),n.d(t,"_",function(){return V});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(75),c=n.n(r),l=n(76),u=n.n(l),d=n(42),m=n.n(d),h=n(16),f=n.n(h),p=n(34),g=n.n(p),v=n(41),b=n(0),y=n(22),w=n(446),C=n(7),j=n(105),k=n.n(j),_=n(74),O=n(35),x=n(194),E=n(829),T=n.n(E),S=n(830),P=n.n(S),A=n(831),I=n.n(A),L=n(832),R=n.n(L),M=n(833),D=n.n(M),B=n(834),H=n.n(B),U=n(198),N=n.n(U),z=n(419),$=function(e){var t=f()(e);t.addClass("gallery-lightbox__button-pulse"),window.setTimeout(function(){t.removeClass("gallery-lightbox__button-pulse")},75)},q=function(e){function t(){return o()(this,t),c()(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u()(t,e),a()(t,[{key:"prerender",value:function(){f()(this.elem).addClass(this.componentClass)}}]),t}(O.a),F=function(){function e(){var t=this;o()(this,e),this.endslate=new q,this.states={closed:{enter:function(){this.hide()},leave:function(){this.show(),Object(_.f)({},document.title,"/"+this.galleryJson.id)},events:{open:function(){this.swipe&&this.swipe.slide(this.index,0),this.state="image"},loadJson:function(e){var t=this;this.galleryJson=e,this.images=e.images||[],this.$countEl.text(this.images.length);var n=this.images.map(function(e,n){return t.generateImgHTML(e,n+1)}).join("");this.$contentEl.html(n),this.$images=Object(v.a)(".js-gallery-lightbox-img",this.$contentEl[0]),this.showEndslate&&this.loadEndslate(),this.$slides=Object(v.a)(".js-gallery-slide",this.$contentEl[0]),this.useSwipe&&this.initSwipe(),this.galleryJson.images.length<2&&(f()([this.nextBtn,this.prevBtn]).hide(),Object(v.a)(".gallery-lightbox__progress",this.lightboxEl).hide()),this.state="image"}}},image:{enter:function(){this.swipeContainerWidth=this.$swipeContainer.dim().width,this.loadSurroundingImages(this.index,this.images.length),this.translateContent(this.index,0,this.useSwipe&&Object(y.l)({max:"tablet"})?100:0),Object(_.f)({},document.title,"/"+this.galleryJson.id+"#img-"+this.index,!0),m.a.on(this.$swipeContainer[0],"click",".js-gallery-content",this.toggleInfo),C.a.on("window:throttledResize",this.resize),this.$indexEl.text(this.index)},leave:function(){m.a.off(this.$swipeContainer[0],"click",this.toggleInfo),C.a.off("window:throttledResize",this.resize)},events:{next:function(){$(this.nextBtn),this.index===this.images.length?this.showEndslate?this.state="endslate":(this.index=1,this.reloadState=!0):(this.index+=1,this.reloadState=!0)},prev:function(){$(this.prevBtn),1===this.index?this.showEndslate?this.state="endslate":(this.index=this.images.length,this.reloadState=!0):(this.index-=1,this.reloadState=!0)},reload:function(){this.reloadState=!0},toggleInfo:function(){$(this.infoBtn),this.$lightboxEl.toggleClass("gallery-lightbox--show-info")},hideInfo:function(){$(this.infoBtn),this.$lightboxEl.removeClass("gallery-lightbox--show-info")},showInfo:function(){$(this.infoBtn),this.$lightboxEl.addClass("gallery-lightbox--show-info")},resize:function(){this.swipeContainerWidth=this.$swipeContainer.dim().width,this.loadSurroundingImages(this.index,this.images.length),this.translateContent(this.index,0,0)},close:function(){this.state="closed"}}},endslate:{enter:function(){this.translateContent(this.$slides.length,0,0),this.index=this.images.length+1,C.a.on("window:throttledResize",this.resize)},leave:function(){C.a.off("window:throttledResize",this.resize)},events:{next:function(){$(this.nextBtn),this.index=1,this.state="image"},prev:function(){$(this.prevBtn),this.index=this.images.length,this.state="image"},reload:function(){this.reloadState=!0},resize:function(){this.swipeContainerWidth=this.$swipeContainer.dim().width,this.translateContent(this.$slides.length,0,0)},close:function(){this.state="closed"}}}},this.showEndslate="mobile"!==Object(y.c)()&&"childrens-books-site"!==b.a.get("page.section")&&"Gallery"===b.a.get("page.contentType"),this.useSwipe=Object(y.i)(),this.swipeThreshold=.05;var n=function(e){var t=P.a;return k()(t,{label:e})},i='<div class="overlay gallery-lightbox gallery-lightbox--closed gallery-lightbox--hover">\n                <div class="gallery-lightbox__sidebar">\n                    '+n("close")+'\n                    <div class="gallery-lightbox__progress  gallery-lightbox__progress--sidebar">\n                        <span class="gallery-lightbox__index js-gallery-index"></span>\n                        <span class="gallery-lightbox__progress-separator"></span>\n                        <span class="gallery-lightbox__count js-gallery-count"></span>\n                    </div>\n                    '+n("next")+"\n                    "+n("prev")+"\n                    "+n("info-button")+'\n                </div>\n                <div class="js-gallery-swipe gallery-lightbox__swipe-container">\n                    <ul class="gallery-lightbox__content js-gallery-content"></ul>\n                </div>\n            </div>';this.lightboxEl=f.a.create(i),this.$lightboxEl=f()(this.lightboxEl).prependTo(document.body),this.$indexEl=Object(v.a)(".js-gallery-index",this.lightboxEl),this.$countEl=Object(v.a)(".js-gallery-count",this.lightboxEl),this.$contentEl=Object(v.a)(".js-gallery-content",this.lightboxEl),this.nextBtn=g()(".js-gallery-next",this.lightboxEl)[0],this.prevBtn=g()(".js-gallery-prev",this.lightboxEl)[0],this.closeBtn=g()(".js-gallery-close",this.lightboxEl)[0],this.infoBtn=g()(".js-gallery-info-button",this.lightboxEl)[0],this.$swipeContainer=Object(v.a)(".js-gallery-swipe"),m.a.on(this.nextBtn,"click",this.trigger.bind(this,"next")),m.a.on(this.prevBtn,"click",this.trigger.bind(this,"prev")),m.a.on(this.closeBtn,"click",this.close.bind(this)),m.a.on(this.infoBtn,"click",this.trigger.bind(this,"toggleInfo")),this.handleKeyEvents=this.handleKeyEvents.bind(this),this.resize=this.trigger.bind(this,"resize"),this.toggleInfo=function(e){f()(e.target).hasClass("js-gallery-lightbox-info")||v.a.ancestor(e.target,"js-gallery-lightbox-info")||t.trigger("toggleInfo")},Object(y.i)()&&this.disableHover(),m.a.on(window,"popstate",function(e){e.state||t.trigger("close")}),this.fsm=new w.a({initial:"closed",onChangeState:function(e,t){this.$lightboxEl.removeClass("gallery-lightbox--"+e).addClass("gallery-lightbox--"+t)},context:this,states:this.states})}return a()(e,[{key:"generateImgHTML",value:function(e,t){var n=b.a.get("page.shortUrl"),i=e.src.startsWith("//")?"http:":"",o=[{text:"Facebook",css:"facebook",icon:Object(x.a)("shareFacebook",["icon"]),url:"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(n+"/sfb#img-"+t)},{text:"Twitter",css:"twitter",icon:Object(x.a)("shareTwitter",["icon"]),url:"https://twitter.com/intent/tweet?text="+encodeURIComponent(b.a.get("page.webTitle"))+"&url="+encodeURIComponent(n+"/stw#img-"+t)},{text:"Pinterest",css:"pinterest",icon:Object(x.a)("sharePinterest",["icon"]),url:encodeURI("http://www.pinterest.com/pin/create/button/?description="+b.a.get("page.webTitle")+"&url="+n+"&media="+i+e.src)}];return k()(T.a.replace(/^\s+|\s+$/gm,""),{articleType:"gallery",count:this.images.length,index:t,caption:e.caption,credit:e.displayCredit?e.credit:"",blockShortUrl:n,shareButtons:o.map(function(e){return k()(D.a,e)}).join(""),shareButtonsMobile:o.map(function(e){return k()(H.a,e)}).join("")})}},{key:"initSwipe",value:function(){var e=this,t=void 0,n=void 0,i=void 0;m.a.on(this.$swipeContainer[0],"touchstart",function(o){t=e.swipeContainerWidth*e.swipeThreshold,n=o.touches[0].pageX,i=0});m.a.on(this.$swipeContainer[0],"touchmove",N()(function(t){t.preventDefault(),t.touches.length>1||t.scale&&1!==t.scale||(i=t.touches[0].pageX-n,e.translateContent(e.index,i,20))},20,{trailing:!1})),m.a.on(this.$swipeContainer[0],"touchend",function(){var n=void 0;n=Math.abs(i)>t?i>t?1:-1:0,i=0,1===n?e.index>1?e.trigger("prev"):e.trigger("reload"):-1===n&&e.index<e.$slides.length?e.trigger("next"):e.trigger("reload")})}},{key:"disableHover",value:function(){this.$lightboxEl.removeClass("gallery-lightbox--hover")}},{key:"trigger",value:function(e,t){this.fsm.trigger(e,t)}},{key:"loadGalleryfromJson",value:function(e,t){this.index=t,this.galleryJson&&e.id===this.galleryJson.id?this.trigger("open"):this.trigger("loadJson",e)}},{key:"loadSurroundingImages",value:function(e,t){var n=this,i=void 0,o=void 0;[-1,0,1].map(function(n){return e+n===0?t-1:(e-1+n)%t}).forEach(function(e){i=n.images[e],(o=f()(n.$images[e])).attr("src")||(o.parent().append(f.a.create(R.a)),o.attr("src",i.src),o.attr("srcset",i.srcsets),o.attr("sizes",i.sizes),m.a.one(o[0],"load",function(){Object(v.a)(".js-loader").remove()}))})}},{key:"translateContent",value:function(e,t,n){var i=-1*(e-1)*this.swipeContainerWidth,o=this.$contentEl[0];Object.assign(o.style,{webkitTransitionDuration:n+"ms",mozTransitionDuration:n+"ms",msTransitionDuration:n+"ms",transitionDuration:n+"ms",webkitTransform:"translate("+(i+t)+"px,0) translateZ(0)",mozTransform:"translate("+(i+t)+"px,0)",msTransform:"translate("+(i+t)+"px,0)",transform:"translate("+(i+t)+"px,0) translateZ(0)"})}},{key:"show",value:function(){var e=f()(document.body);this.bodyScrollPosition=e.scrollTop(),e.addClass("has-overlay"),this.$lightboxEl.addClass("gallery-lightbox--open"),m.a.off(document.body,"keydown",this.handleKeyEvents),m.a.on(document.body,"keydown",this.handleKeyEvents)}},{key:"close",value:function(){_.h?Object(_.a)():this.trigger("close"),this.trigger("close")}},{key:"hide",value:function(){var e=this,t=f()(document.body);t.removeClass("has-overlay"),m.a.off(document.body,"keydown",this.handleKeyEvents),window.setTimeout(function(){e.bodyScrollPosition&&t.scrollTop(e.bodyScrollPosition),e.$lightboxEl.removeClass("gallery-lightbox--open"),C.a.emit("ui:images:vh")},1)}},{key:"handleKeyEvents",value:function(e){37===e.keyCode?this.trigger("prev"):39===e.keyCode?this.trigger("next"):38===e.keyCode?this.trigger("showInfo"):40===e.keyCode?this.trigger("hideInfo"):27===e.keyCode?this.close():73===e.keyCode&&this.trigger("toggleInfo")}},{key:"loadEndslate",value:function(){!this.endslate.rendered&&this.$contentEl&&(this.endslateEl=f.a.create(I.a),this.$contentEl.append(this.endslateEl),this.endslate.componentClass="gallery-lightbox__endslate",this.endslate.endpoint="/gallery/most-viewed.json",this.endslate.fetch(g()(".js-gallery-endslate",this.endslateEl),"html"))}}]),e}(),Y=function(){z.a.then(function(){var e=b.a.get("page.lightboxImages");if(e&&e.images.length>0){var t=void 0,n=window.location.hash,i=void 0;m.a.on(document.body,"click",".js-gallerythumbs",function(n){n.preventDefault();var i=f()(n.currentTarget),o=(i.attr("href")||i.attr("data-gallery-url")).split("#img-"),s=parseInt(o[1],10),a=Number.isNaN(s)?1:s;(t=t||new F).loadGalleryfromJson(e,a)}),t=t||new F;var o="/"+b.a.get("page.pageId"),s=/\?index=(\d+)/.exec(document.location.href);s?(Object(_.f)({},document.title,o,!0),t.loadGalleryfromJson(e,parseInt(s[1],10))):(i=/^#(?:img-)?(\d+)$/.exec(n))&&t.loadGalleryfromJson(e,parseInt(i[1],10))}})},V={GalleryLightbox:F}},471:function(e,t,n){var i;void 0!==(i=function(){var e=Math.ceil,t=Math.max;return function(n,i,o){n=+n||0,o="number"==typeof o?o:+o||1,null==i&&(i=n,n=0);for(var s=-1,a=t(0,e((i-n)/(o||1))),r=Array(a);++s<a;)r[s]=n,n+=o;return r}}.apply(t,[]))&&(e.exports=i)},498:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(27),o=n.n(i),s=n(199),a=function(e){Object(s.a)("flashing-elements")?e&&e():o.a.write(function(){document.body&&document.body.classList.add("disable-flashing-elements"),e&&e()})}},499:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(815),o=n.n(i),s=n(41),a=n(192),r=n(498),c=n(557),l=n(816),u=n(817),d=function(){Object(s.a)(".fenced").each(o.a.render)},m=function(){Object(c.b)(),Object(c.a)()},h=function(){Object(a.b)([["trail-a11y",r.a],["trail-fence",d],["trail-twitter",m],["trail-sharing",u.a],["trail-last-modified",l.a]])}},500:function(e,t,n){"use strict";n.d(t,"a",function(){return M});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(75),c=n.n(r),l=n(76),u=n.n(l),d=n(42),m=n.n(d),h=n(16),f=n.n(h),p=n(34),g=n.n(p),v=n(41),b=n(37),y=n(0),w=n(22),C=n(7),j=n(221),k=n(72),_=n(23),O=n(501),x=n(397),E=n(35),T=n(391),S=n(451),P=n(503),A=n(505),I=n(506),L=n(96),R=n(106),M=function(e){function t(){o()(this,t);var e=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.classes={},e.componentClass="discussion",e.comments=null,e.user=null,e.username=null,Object(x.a)("discussion"),e}return u()(t,e),a()(t,[{key:"getUser",value:function(){var e=this;Object(L.d)()?Object(T.a)().then(function(t){e.user=t.userProfile,Object(L.b)(function(t){t&&t.publicFields.username&&(e.username=t.publicFields.username),e.emit("user:loaded")})}):this.emit("user:loaded")}},{key:"getDiscussionId",value:function(){if(this.elem&&this.elem instanceof HTMLElement)return this.elem.getAttribute("data-discussion-key")}},{key:"getDiscussionClosed",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-discussion-closed"))}},{key:"getCommentIdFromHash",value:function(){var e=/#comment-(\d+)/;return e.exec(window.location.hash)?parseInt(e.exec(window.location.hash)[1],10):null}},{key:"setCommentHash",value:function(e){window.location.replace("#comment-"+e)}},{key:"commentPosted",value:function(e){this.removeState("truncated"),this.comments&&this.comments.addComment(e)}},{key:"initState",value:function(){this.getDiscussionClosed()?this.setState("closed"):this.comments&&this.comments.isReadOnly()?this.setState("readonly"):Object(L.d)()&&this.user&&this.user.privateFields&&!this.user.privateFields.canPostComment?this.setState("banned"):this.setState("open")}},{key:"isCommentable",value:function(){var e=this.user&&this.user.privateFields&&this.user.privateFields.canPostComment,t=this.comments&&!this.comments.isReadOnly();return!(!e||!t||this.getDiscussionClosed())}},{key:"ready",value:function(){var e=this;this.$topCommentsContainer=Object(v.a)(".js-discussion-top-comments"),this.initTopComments(),this.initMainComments(),this.initToolbar(),this.renderCommentCount(),this.initPagination(),this.initRecommend(),Object(O.a)(),"#comments"===window.location.hash?C.a.emit("discussion:seen:comments-anchor"):this.getCommentIdFromHash()&&C.a.emit("discussion:seen:comment-permalink"),C.a.on("discussion:commentbox:post:success",function(){return e.removeState("empty")}),C.a.on("module:clickstream:click",function(t){t&&"hash"in t.target&&"#comments"===t.target.hash&&e.removeTruncation()}),Object(x.b)("discussion")}},{key:"initRecommend",value:function(){var e=this;this.on("click",".js-recommend-comment",function(t){var n=t.currentTarget;e.user&&e.elem instanceof HTMLElement&&Object(I.b)(n,e.elem,e.user)}),this.on("click",".js-rec-tooltip-close",function(){Object(I.a)()})}},{key:"initToolbar",value:function(){var e=this,t=Object(v.a)(".js-comment-order"),n=Object(v.a)(".js-comment-threading");if(n.text(this.comments&&this.comments.options.threading),t.text(this.comments&&this.comments.options.order),this.on("click",".js-comment-order-dropdown .popup__action",function(n){m.a.fire(g()(".js-comment-order-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.order=f()(n.currentTarget).data("order")),t.text(e.comments&&e.comments.options.order),R.a.set("discussion.order",e.comments&&e.comments.options.order),e.loadComments({page:1})}),this.on("click",".js-comment-threading-dropdown .popup__action",function(t){m.a.fire(g()(".js-comment-threading-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.threading=f()(t.currentTarget).data("threading")),n.text(e.comments&&e.comments.options.threading),R.a.set("discussion.threading",e.comments&&e.comments.options.threading),e.loadComments()}),"crosswords"===y.a.get("page.section")){var i=Object(v.a)(".js-timestamps"),o=function(e){i.text(e?"Relative":"Absolute")};o();var s=null===R.a.get("discussion.enableRelativeTimestamps")||R.a.get("discussion.enableRelativeTimestamps");o(s),this.on("click",".js-timestamps-dropdown .popup__action",function(t){var n=f()(t.currentTarget).data("timestamp");m.a.fire(g()(".js-timestamps-dropdown [data-toggle]")[0],"click"),o("relative"===n),R.a.set("discussion.enableRelativeTimestamps","relative"===n),e.loadComments()})}}},{key:"initPageSizeDropdown",value:function(e){var t=this,n=Object(v.a)(".js-comment-pagesize");n.text(e),this.on("click",".js-comment-pagesize-dropdown .popup__action",function(e){var i=f()(e.currentTarget).data("pagesize");m.a.fire(g()(".js-comment-pagesize-dropdown [data-toggle]")[0],"click"),t.comments&&(t.comments.options.pagesize=i),n.text(i),R.a.set("discussion.pagesize",i),t.loadComments({page:1})})}},{key:"initMainComments",value:function(){var e=this,t=this.getCommentIdFromHash(),n=R.a.get("discussion.order")||(this.getDiscussionClosed()?"oldest":"newest"),i=R.a.get("discussion.threading")||"collapsed",o=Object(w.l)({min:"tablet"})?25:10;this.comments=new P.a({discussionId:this.getDiscussionId(),order:n,pagesize:o,threading:i}),this.comments&&this.comments.attachTo(g()(".js-discussion-main-comments")[0]),this.comments&&this.comments.on("untruncate-thread",function(){return e.removeTruncation()}),this.on("click,",".js-discussion-author-link",function(){return e.removeTruncation()}),this.on("click",".js-discussion-change-page, .js-discussion-show-button",function(){C.a.emit("discussion:comments:get-more-replies"),e.removeTruncation()}),this.comments&&this.comments.on("rendered",function(t){var n=f.a.create(t),i=g()(".js-discussion-toolbar",e.elem)[0],o=Object(v.a)(".js-discussion-pagination",i).empty();e.comments&&!e.comments.isAllPageSizeActive()&&o.html(n)}),this.setState("loading"),this.on("user:loaded",function(){if(e.initState(),e.renderCommentBar(),e.user){e.comments&&e.comments.addUser(e.user);var n=R.a.get("discussion.pagesize"),i=o;"number"==typeof n?i=n:"All"===n&&(i=y.a.get("switches.discussionAllPageSize")?"All":100),e.initPageSizeDropdown(i),e.comments&&y.a.get("switches.discussionPageSize")&&Object(w.l)({min:"tablet"})&&(e.comments.options.pagesize=i),e.user&&e.user.isStaff&&(e.removeState("not-staff"),e.setState("is-staff"))}var s=!t&&"#comments"!==window.location.hash;e.loadComments({comment:t,shouldTruncate:s}).catch(function(){return e.logError("Comments")})}),this.getUser()}},{key:"initTopComments",value:function(){var e=this,t=this.getDiscussionId();return this.on("click",".js-jump-to-comment",function(t){t.preventDefault();var n=f()(t.currentTarget).data("comment-id");e.gotoComment(n)}),t?Object(_.a)("/discussion/top-comments/"+t+".json?commentsClosed="+this.getDiscussionClosed().toString(),{mode:"cors"}).then(function(t){e.$topCommentsContainer.html(t.html),e.topCommentCount=g()(".d-top-comment",e.$topCommentsContainer[0]).length,0!==e.topCommentCount&&(Object(v.a)(".js-discussion-comment-box--bottom").removeClass("discussion__comment-box--bottom--hidden"),e.setState("has-top-comments"))}).catch(function(){return e.logError("Top comments")}):Promise.resolve()}},{key:"logError",value:function(e,t){var n=e+" failed to load: ";t&&t.message&&(n+=t.message),b.a.captureMessage(n,{tags:{contentType:"comments",discussionId:this.getDiscussionId()}})}},{key:"initPagination",value:function(){var e=this;this.on("click",".js-discussion-change-page",function(t){var n=t.currentTarget,i=parseInt(n.getAttribute("data-page"),10);t.preventDefault(),e.setState("loading"),e.gotoPage(i)})}},{key:"gotoComment",value:function(e,t){var n=this;Object(v.a)("#comment-"+e,this.elem).length>0?"none"===Object(v.a)(".js-discussion-main-comments").css("display")?k.a.write(function(){n.comments&&n.comments.showHiddenComments(),n.removeState("truncated"),Object(v.a)(".d-discussion__show-all-comments").addClass("u-h")}).then(function(){n.setCommentHash(e)}):this.setCommentHash(e):t?(Object(j.b)(g()(".js-discussion-toolbar"),100),k.a.write(function(){Object(v.a)(".js-discussion-main-comments").prepend('<div class="d-discussion__message d-discussion__message--error">The comment you requested could not be found.</div>')}),b.a.captureMessage("Comment doesn't exist in response",{level:"error",extra:{commentId:e}})):this.loadComments({comment:e})}},{key:"gotoPage",value:function(e){Object(j.b)(g()(".js-discussion-toolbar"),100),this.comments&&this.comments.relativeDates(),this.loadComments({page:e})}},{key:"loadComments",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},t);return this.setState("loading"),n.shouldTruncate&&this.comments&&this.comments.isAllPageSizeActive()&&(n.pageSize=10),n.commentsClosed=this.getDiscussionClosed(),this.comments?this.comments.fetchComments(n).then(function(){e.removeState("loading"),n.shouldTruncate?e.setState("truncated"):e.removeState("truncated"),e.comments&&e.comments.shouldShowPageSizeMessage()?e.setState("pagesize-msg-show"):e.removeState("pagesize-msg-show"),n.comment&&e.gotoComment(n.comment.toString(),!0)}):Promise.resolve()}},{key:"removeTruncation",value:function(){this.comments&&this.comments.isAllPageSizeActive()?this.loadComments():this.removeState("truncated")}},{key:"renderCommentBox",value:function(e){var t=this;new S.a({discussionId:this.getDiscussionId(),premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,newCommenter:this.user&&this.user.privateFields&&!this.user.privateFields.hasCommented,hasUsername:null!==this.username,shouldRenderMainAvatar:!1}).render(e).on("post:success",function(e){return t.commentPosted(e)})}},{key:"renderCommentBar",value:function(){this.isCommentable()&&(this.renderCommentBox(g()(".js-discussion-comment-box--top")[0]),this.renderCommentBox(g()(".js-discussion-comment-box--bottom")[0]))}},{key:"renderCommentCount",value:function(){Object(A.a)(this,{apiHost:y.a.page.discussionApiUrl,avatarImagesHost:y.a.page.avatarImagesUrl,closed:this.getDiscussionClosed(),discussionId:this.getDiscussionId(),element:document.getElementsByClassName("js-discussion-external-frontend")[0],userFromCookie:!!Object(L.d)(),profileUrl:y.a.page.idUrl,profileClientId:y.a.switches.registerWithPhone?"comments":"",Promise:Promise})}}]),t}(E.a)},501:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var i=n(41),o=n(16),s=n.n(o),a=n(0),r=n(29),c=n.n(r),l=n(7),u=!1,d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.a.get("googleAnalytics.trackers.editorial");window.ga(n+".send","event","element view","onpage item",e,Object.assign({nonInteraction:!0},t))},m=function(){u||(u=!0)},h=function(){u||(u=!0)},f=function(){u||(d("scroll to comments"),u=!0)},p=function(){var e=Object(i.a)("#comments").offset(),t=window.pageYOffset,n=s.a.viewport().height;return e.top-n/2<t&&e.top+e.height-n/3>t},g=function(){u||l.a.on("window:throttledScroll",c()(function e(){!u&&p()&&(f(),l.a.off("window:throttledScroll",c()(e,200)))},200))},v=function(){l.a.on("discussion:seen:comment-permalink",h),l.a.on("discussion:seen:comments-anchor",m),g()}},502:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(e){var t=new RegExp("\\b((https?://|www.)\\S+)\\b(?![^<]*>|[^<>]*</)","g");return e.replace(t,function(e,t,n){return'<a href="'+("www."===n?"http://"+t:t)+'">'+t+"</a>"})}},503:function(e,t,n){"use strict";n.d(t,"a",function(){return L});var i=n(165),o=n.n(i),s=n(11),a=n.n(s),r=n(13),c=n.n(r),l=n(75),u=n.n(l),d=n(76),m=n.n(d),h=n(41),f=n(42),p=n.n(f),g=n(16),v=n.n(g),b=n(34),y=n.n(b),w=n(0),C=n(23),j=n(7),k=n(73),_=n(74),O=n(35),x=n(391),E=n(451),T=n(504),S=n(398),P=n(106),A=n(194),I=function(){return null===P.a.get("discussion.enableRelativeTimestamps")||P.a.get("discussion.enableRelativeTimestamps")},L=function(e){function t(e){a()(this,t);var n=u()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.componentClass="d-comments",n.comments=null,n.topLevelComments=null,n.user=null,n.classes={comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",reply:"d-comment--response",showReplies:"d-show-more-replies",showRepliesButton:"d-show-more-replies__button",newComments:"js-new-comments",comment:"d-comment",commentReply:"d-comment__action--reply",commentPick:"d-comment__action--pick",commentStaff:"d-comment--staff",commentBody:"d-comment__body",commentTimestampJs:"js-timestamp",commentReport:"js-report-comment"},n.defaultOptions={discussionId:null,showRepliesCount:3,commentId:null,order:"newest",threading:"collapsed"},n.setOptions(e),n}return m()(t,e),c()(t,[{key:"getMoreReplies",value:function(e){var t=this;e.preventDefault();var n=e.target,i=e.currentTarget,o=i.closest(this.getClass("showReplies"));o&&(o.innerHTML="Loading");var s=v()(n).data("source-comment"),a=i.getAttribute("data-comment-id");if(a){var r="/discussion/comment/"+a+".json?displayThreaded=true";Object(C.a)(r,{mode:"cors"}).then(function(e){var n=v.a.create(e.html),i=y()(t.getClass("reply"),n).slice(t.options&&t.options.showRepliesCount);v()(y()(".d-thread--responses",s)).append(i),v()(o).addClass("u-h"),t.emit("untruncate-thread"),I()&&t.relativeDates()}).catch(function(e){Object(k.a)(e,{feature:"comments-more-replies"})})}}},{key:"addMoreRepliesButtons",value:function(e){var t=this;(e||this.topLevelComments).forEach(function(e){var n=parseInt(e.getAttribute("data-comment-replies"),10),i=y()(t.getClass("reply"),e);if(i.length<n){var o=n-i.length,s='\n                    <button class="u-button-reset button button--show-more button--small button--tone-news d-show-more-replies__button">\n                        '+Object(A.a)("plus",["icon"])+"Show "+o+" more "+(1===o?"reply":"replies")+"\n                    </button>",a=h.a.create(s).attr({"data-link-name":"Show more replies","data-is-ajax":"","data-comment-id":e.getAttribute("data-comment-id")}).data("source-comment",e);h.a.create('<li class="'+t.getClass("showReplies",!0)+'"></li>').append(a).appendTo(Object(h.a)(".d-thread--responses",e))}})}},{key:"fetchComments",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(this.options||{}).discussionId,i="/discussion/"+(t.comment?"comment-context/"+t.comment:n)+".json",o=t.order||this.options&&this.options.order,s=void 0,a={mode:"cors"};"recommendations"===o&&(o="mostRecommended");var r={orderBy:o,pageSize:t.pagesize||this.options&&this.options.pagesize,displayThreaded:!(!this.options||"unthreaded"===this.options.threading),commentsClosed:t.commentsClosed};return t.page&&(r.page=t.page),!t.comment&&this.options&&"collapsed"===this.options.threading&&(r.maxResponses=3),this.isAllPageSizeActive()?s=new T.a({discussionId:this.options&&this.options.discussionId,orderBy:r.orderBy,displayThreaded:r.displayThreaded,maxResponses:r.maxResponses,commentsClosed:r.commentsClosed}).loadAllComments().catch(function(){return e.wholeDiscussionErrors=!0,r.pageSize=100,Object(C.a)(i+"?"+Object(_.b)(r),a)}):("All"===r.pageSize&&(r.pageSize=100),s=Object(C.a)(i+"?"+Object(_.b)(r),a)),s.then(function(t){return e.renderComments(t)})}},{key:"handlePickClick",value:function(e){e.preventDefault();var t=e.target,n=t.getAttribute("data-comment-id"),i=Object(h.a)(t),o="true"===i[0].getAttribute("data-comment-highlighted")?this.unPickComment:this.pickComment;n&&o.call(this,n,i).catch(function(e){var t=e.response.length>0?JSON.parse(e.response).message:e.statusText;i.text(t)})}},{key:"pickComment",value:function(e,t){var n=this,i=y()("#comment-"+e,this.elem);return Object(x.b)(e).then(function(){Object(h.a)(n.getClass("commentPick"),i).removeClass("u-h"),t.text("Unpick"),i.setAttribute("data-comment-highlighted",!0)})}},{key:"ready",value:function(){var e=this;this.topLevelComments=y()(this.getClass("topLevelComment"),this.elem),this.comments=y()(this.getClass("comment"),this.elem),this.on("click",this.getClass("showRepliesButton"),function(t){return e.getMoreReplies(t)}),this.on("click",this.getClass("commentReport"),function(t){return e.reportComment(t)}),I()&&(window.setInterval(function(){return e.relativeDates()},6e4),this.relativeDates()),this.emit("ready"),this.on("click",".js-report-comment-close",function(){var e=document.querySelector(".js-report-comment-form");e&&e.setAttribute("hidden","")})}},{key:"showHiddenComments",value:function(e){e&&e.preventDefault(),this.emit("first-load"),Object(h.a)(".js-discussion-main-comments").css("display","block"),I()&&this.relativeDates()}},{key:"unPickComment",value:function(e,t){var n=this,i=y()("#comment-"+e);return Object(x.g)(e).then(function(){Object(h.a)(n.getClass("commentPick"),i).addClass("u-h"),t.text("Pick"),i.setAttribute("data-comment-highlighted",!1)})}},{key:"isReadOnly",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-read-only"))}},{key:"addComment",value:function(e,t){var n=v.a.create(this.postedCommentEl)[0],i=v()(n),s=n&&n.getElementsByClassName(this.getClass("commentReply",!0))[0],a={username:"d-comment__author",timestamp:"js-timestamp",body:"d-comment__body",report:"d-comment__action--report",avatar:"d-comment__avatar"},r={username:this.user&&this.user.displayName,timestamp:"Just now",body:"<p>"+e.body.replace(/\n+/g,"</p><p>")+"</p>",report:{href:"http://discussion.theguardian.com/components/report-abuse/"+e.id},avatar:{src:this.user&&this.user.avatar}};i.addClass("d-comment--new"),Object.keys(a).forEach(function(e){var t=a[e],i=r[e],s=y()("."+t,n)[0];"string"==typeof i?s.innerHTML=i:"object"===(void 0===i?"undefined":o()(i))&&Object.keys(i).forEach(function(e){s.setAttribute(e,i[e])})}),n.id="comment-"+e.id,this.user&&!this.user.isStaff&&i.addClass(this.getClass("commentStaff",!0)),s&&s.setAttribute("data-comment-id",e.id),t?(i.removeClass(this.getClass("topLevelComment",!0)),i.addClass(this.getClass("reply",!0)),v()(t).append(i)):Object(h.a)(this.getClass("newComments"),this.elem).prepend(n),window.location.replace("#comment-"+e.id)}},{key:"replyToComment",value:function(e){var t=this;e.preventDefault();var n=e.currentTarget.getAttribute("data-comment-id");if(n){var i=document.getElementById("reply-to-"+n);if(i)i.focus();else{Object(h.a)(".d-comment-box--response").remove();var o=y()("#comment-"+n)[0],s=o.getAttribute("data-comment-author"),a=o.getAttribute("data-comment-author-id"),r=v()(o),c=y()(this.getClass("commentBody"),o)[0].innerHTML,l=y()(this.getClass("commentTimestampJs"),o)[0].innerHTML,u=new E.a({discussionId:this.options&&this.options.discussionId,premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:n,author:s,authorId:a,body:c,timestamp:l},focus:!0}),d=r.hasClass(this.getClass("topLevelComment",!0))?r[0]:r.parent().parent()[0],m=y()(this.getClass("showReplies"),d);m.length>0&&!v()(m).hasClass("u-h")&&m[0].click(),u.render(d),u.on("post:success",function(e){var n=y()(".d-thread--responses",d)[0];n||(n=v.a.create('<ul class="d-thread d-thread--responses"></ul>')[0],v()(d).append(n)),u.destroy(),t.addComment(e,n)})}}}},{key:"reportComment",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-comment-id");if(t){var n=document.querySelector("#comment-"+t+" .js-report-comment-container");Object(h.a)(".js-report-comment-form").first().each(function(e){e.removeAttribute("hidden"),p.a.one(e,"submit",function(n){n.preventDefault();var i=e.querySelector('[name="category"]'),o=e.querySelector('[name="comment"]'),s=function(e){e.setAttribute("hidden","")},a=function(){var e=document.querySelector(".d-report-comment__close"),t=document.querySelector(".js-discussion__report-comment-error");t&&t.removeAttribute("hidden"),e&&e.classList.add("d-report-comment__close--error")};if(t&&"0"!==i.value){var r=e.querySelector('[name="email"]');Object(x.f)(t,{emailAddress:r.value,categoryId:i.value,reason:o.value}).then(function(){return s(e)}).catch(function(){return a()})}})}).appendTo(n)}}},{key:"addUser",value:function(e){var t=this;this.user=e,this.user&&this.user.badge&&(this.user.isStaff=this.user.badge.some(function(e){return"Staff"===e.name})),this.isReadOnly()||this.user&&this.user.privateFields.canPostComment&&(Object(h.a)(this.getClass("commentReply")).attr("href","#"),this.on("click",this.getClass("commentReply"),function(e){return t.replyToComment(e)}),this.on("click",this.getClass("commentPick"),function(e){return t.handlePickClick(e)})),j.a.on("user:username:updated",function(e){t.user&&(t.user.displayName=e)})}},{key:"relativeDates",value:function(){I()&&Object(S.a)()}},{key:"isAllPageSizeActive",value:function(){return!(!w.a.get("switches.discussionAllPageSize")||!this.options||"All"!==this.options.pagesize||this.wholeDiscussionErrors)}},{key:"shouldShowPageSizeMessage",value:function(){return!!(w.a.get("switches.discussionAllPageSize")&&this.options&&"All"===this.options.pagesize&&this.wholeDiscussionErrors)}},{key:"renderComments",value:function(e){var t=v.a.create(e.commentsHtml),n=y()(this.getClass("comment"),t);v()(this.elem).empty().append(t),this.addMoreRepliesButtons(n),this.postedCommentEl=e.postedCommentHtml,I()&&this.relativeDates(),this.emit("rendered",e.paginationHtml),j.a.emit("modules:comments:renderComments:rendered")}}]),t}(O.a)},504:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(41),c=n(16),l=n.n(c),u=n(23),d=n(74),m=n(471),h=n.n(m),f=function(e,t){return new Promise(function(n){var i=t,o=0,s=function(){o-=1,i.length?a(i.shift()):o||n()},a=function(t){o+=1,e.call(null,t).then(s,s)};t&&t.length?t.splice(0,3).forEach(a):n()})},p=function(){function e(t){o()(this,e),this.discussionId=t.discussionId,this.discussion=[],this.params={orderBy:t.orderBy,displayThreaded:t.displayThreaded,maxResponses:t.maxResponses,commentsClosed:t.commentsClosed}}return a()(e,[{key:"firstPageLoaded",value:function(e){if(this.storeCommentPage(e,1),this.discussionContainer=l.a.create(e.commentsHtml),this.postedCommentHtml=e.postedCommentHtml,this.lastPage=e.lastPage,this.commentsThread=Object(r.a)(".d-thread--comments",this.discussionContainer).empty(),e.commentCount>1e3)throw new Error("Discussion comment count too large");return h()(2,this.lastPage+1)}},{key:"storeCommentPage",value:function(e,t){var n=Object(r.a)(".d-thread--comments",l.a.create(e.commentsHtml)),i=Object(r.a)(".d-comment--top-level",n);"newest"===this.params.orderBy&&(i=i.map(function(e){return e}).reverse()),this.discussion[t]=i}},{key:"loadPage",value:function(e){var t={orderBy:"oldest",page:e,pageSize:50,displayThreaded:this.params.displayThreaded,commentsClosed:this.params.commentsClosed};this.params.maxResponses&&(t.maxResponses=this.params.maxResponses);var n="/discussion/"+this.discussionId+".json?"+Object(d.b)(t);return Object(u.a)(n,{mode:"cors"})}},{key:"loadPageAndStore",value:function(e){var t=this;return this.loadPage(e).then(function(n){t.storeCommentPage(n,e)})}},{key:"loadRemainingPages",value:function(e){return f(this.loadPageAndStore.bind(this),e)}},{key:"makeDiscussionResponseObject",value:function(){return"newest"===this.params.orderBy&&this.discussion.reverse(),this.discussion.reduce(function(e,t){return e.append(t),e},this.commentsThread),{paginationHtml:"",postedCommentHtml:this.postedCommentHtml,commentsHtml:this.discussionContainer.html(),lastPage:this.lastPage}}},{key:"loadAllComments",value:function(){var e=this;return this.loadPage(1).then(function(t){return e.firstPageLoaded(t)}).then(function(t){return e.loadRemainingPages(t)}).then(function(){return e.makeDiscussionResponseObject()})}}]),e}()},505:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i=n(33),o=n.n(i),s=n(0),a=n(27),r=n.n(a),c=n(469),l=n(193),u=n(7),d=n(73),m=function(e,t){var n=function(e,t){var n=Object(c.a)(t);n&&r.a.write(function(){e.textContent=n})},i=function(t){t.on("error",function(e,t){Object(d.a)(t,{feature:"discussion-"+e},!1)}),t.once("comment-count",function(t){if(0===t)e.setState("empty");else{var i=document.getElementsByClassName("js_commentcount_actualvalue");[].concat(o()(i)).forEach(function(e){n(e,t)})}u.a.emit("comments-count-loaded")})},a=function(e){Object(d.a)(e,{feature:"discussion"})},m=function(e){e(t).then(i).catch(a)};return Object(l.a)(s.a.get("page.discussionFrontendUrl")).then(function(){m(window.guardian.app.discussion)}).catch(a)}},506:function(e,t,n){"use strict";n.d(t,"b",function(){return f}),n.d(t,"a",function(){return p});var i=n(0),o=n(72),s=n(73),a=n(74),r=n(391),c=function(e,t){for(var n=0,i=e.length;n<i;n+=1){var o=e[n].getAttribute("href");if(o){var s=o.split("?")[0],r=Object(a.d)(o.split("?")[1]||"&");e[n].setAttribute("href",s+"?"+Object(a.b)(Object.assign({},r,{returnUrl:t})))}}},l=function(e){var t=document.querySelector(".js-rec-tooltip");if(!t)return Promise.resolve();var n=t.querySelectorAll(".js-rec-tooltip-link");return o.a.write(function(){c(n,e.getAttribute("data-comment-url")),t.removeAttribute("hidden"),e.appendChild(t)})},u=function(e){return!!e&&!!e.querySelector(".d-discussion--recommendations-open")},d=function(e){return o.a.write(function(){e.classList.remove("js-recommend-comment"),e.classList.add("d-comment__recommend--clicked")})},m=function(e){return o.a.write(function(){e.classList.add("js-recommend-comment"),e.classList.remove("d-comment__recommend--clicked")})},h=function(e){return o.a.write(function(){e.classList.add("d-comment__recommend--recommended")})},f=function(e,t,n){if(!i.a.switches.discussionAllowAnonymousRecommendsSwitch&&!n)return e.setAttribute("data-link-name","Recommend comment anonymous"),l(e);if((i.a.switches.discussionAllowAnonymousRecommendsSwitch||n)&&u(t)){var o=e.getAttribute("data-comment-id");return o?Promise.all([d(e),Object(r.e)(o)]).then(function(){return h(e)}).catch(function(t){return m(e).then(function(){Object(s.a)(t,{feature:"comments-recommend"})})}):Promise.resolve()}return Promise.resolve()},p=function(){return o.a.write(function(){var e=document.querySelector(".js-rec-tooltip");e&&e.setAttribute("hidden","")})}},507:function(e,t,n){"use strict";n.d(t,"a",function(){return b});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(75),c=n.n(r),l=n(76),u=n.n(l),d=n(33),m=n.n(d),h=n(0),f=n(7),p=n(397),g=function(){return[].concat(m()(h.a.get("page.nonKeywordTagIds","").split(",")),m()(h.a.get("page.blogIds","").split(",")),[h.a.get("page.seriesId")]).shift()},v=function(){return encodeURIComponent(h.a.get("page.shortUrl"))},b=function(e){function t(e){o()(this,t);var n=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object(p.a)("series-content"),n.endpoint="/series/"+g()+".json?shortUrl="+v(),n.fetch(e,"html"),n}return u()(t,e),a()(t,[{key:"error",value:function(){Object(p.c)("series-content")}},{key:"ready",value:function(){Object(p.b)("series-content"),f.a.emit("modules:onward:loaded")}}]),t}(n(35).a)},556:function(e,t,n){"use strict";n.d(t,"b",function(){return v}),n.d(t,"a",function(){return g});var i=n(72),o=n(0),s=n(22),a=n(23),r=n(7),c=n(73),l=n(390),u=function(e){var t=e.href;return'<aside class=" element element-rich-link element-rich-link--tag\n                    element--thumbnail element-rich-link--not-upgraded"\n            data-component="rich-link-tag"\n            data-link-name="rich-link-tag"\n            >\n        <p><a href="'+t+'">'+t+"</a></p>\n    </aside>"},d=function(e){return i.a.read(function(){var t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement&&document.documentElement.clientHeight||0;return t.top>n})},m=function(e,t){return i.a.write(function(){e.innerHTML=t.html,e.classList.remove("element-rich-link--not-upgraded"),e.classList.add("element-rich-link--upgraded"),Array.from(document.getElementsByClassName("submeta-container--break")).forEach(function(e){e.classList.remove("submeta-container--break")}),r.a.emit("rich-link:loaded",e)})},h=function(e){var t=e.querySelector("a");if(!t)return Promise.resolve();var n=t.href,i=o.a.get("page.host"),r=n.split(i),l=Object(s.l)({max:"mobileLandscape"});return r&&r[1]?Object(a.a)("/embed/card"+r[1]+".json",{mode:"cors"}).then(function(t){t.html&&(l?d(e).then(function(n){n&&m(e,t)}):m(e,t))}).catch(function(e){Object(c.a)(e,{feature:"rich-links"})}):Promise.resolve()},f=function(){return{bodySelector:".js-article__body",slotSelector:" > p",minAbove:200,minBelow:250,clearContentMeta:50,selectors:{" > h2":{minAbove:"mobile"===Object(s.c)()?20:0,minBelow:200}," > *:not(p):not(h2):not(blockquote)":{minAbove:35,minBelow:300}," .ad-slot":{minAbove:150,minBelow:200}," .element-rich-link":{minAbove:500,minBelow:500}}}},p=function(e){return e.includes(o.a.get("page.richLink"))},g=function(){var e=void 0,t=Array.from(document.querySelectorAll(".element-rich-link a")).map(function(e){return e.href}).some(p),n=o.a.get("page.shouldHideAdverts")||!o.a.get("page.showRelatedContent");return!o.a.get("page.richLink")||o.a.get("page.richLink").includes(o.a.get("page.pageId"))||n||t?Promise.resolve():l.a.fillSpace(f(),function(t){var n=u({href:o.a.get("page.richLink")});return t[0].insertAdjacentHTML("beforebegin",n),e=t[0].previousElementSibling}).then(function(t){if(t&&e)return h(e)})},v=function(){Array.from(document.getElementsByClassName("element-rich-link--not-upgraded")).forEach(h)}},557:function(e,t,n){"use strict";n.d(t,"b",function(){return h}),n.d(t,"a",function(){return m});var i=n(27),o=n.n(i),s=n(0),a=n(22),r=n(7),c=n(29),l=n.n(c),u=document.querySelector(".js-liveblog-body, .js-article__body, .js-article__body--minute-article"),d=function(){var e=Array.from(document.querySelectorAll("blockquote.twitter-tweet")),t=document.getElementById("twitter-widget");if(e.length){if(!t){var n=document.createElement("script"),i=document.scripts[0];n.id="twitter-widget",n.async=!0,n.src="//platform.twitter.com/widgets.js",i&&i.parentNode&&i.parentNode.insertBefore(n,i)}"undefined"!=typeof twttr&&twttr.widgets&&twttr.widgets.load&&twttr.widgets.load(u)}},m=function(){if(("mobile"!==Object(a.c)()||s.a.get("page.isMinuteArticle"))&&s.a.get("switches.enhanceTweets")){var e=Array.from(document.querySelectorAll("blockquote.js-tweet")),t=Object(a.f)().height;e.forEach(function(e){var n=e.getBoundingClientRect();2.5*t>n.top&&n.top+n.height>0&&o.a.write(function(){e.classList.remove("js-tweet"),e.classList.add("twitter-tweet"),d()})})}},h=function(){r.a.on("window:throttledScroll",l()(m,200))}},812:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"init",function(){return C});var i=n(0),o=n(34),s=n.n(o),a=n(41),r=n(192),c=n(22),l=n(7),u=n(74),d=n(556),m=n(813),h=n(441),f=n(814),p=n(499),g=n(424),v=n(828),b=n(30),y=n.n(b),w={initCmpParam:function(){var e=Object(u.d)();e.CMP&&Object(a.a)(".element-pass-cmp").each(function(t){t.src=t.src+"?CMP="+e.CMP})},initRightHandComponent:function(){var e=s()(".js-content-main-column");!i.a.hasTone("Match reports")&&e[0]&&e[0].offsetHeight>1150&&Object(c.l)({min:"desktop"})?h.a.render():l.a.emit("modules:onward:geo-most-popular:cancel")},initQuizListeners:function(){l.a.on("quiz/ophan-event",y.a.record)},optInEngagementBanner:function(){i.a.switches.idShowOptInEngagementBanner&&Object(v.a)()},emitReadyEvent:function(){l.a.emit("page:article:ready")}},C=function(){Object(r.b)([["article-trails",g.initTrails],["article-liveblog-common",p.a],["article-righthand-component",w.initRightHandComponent],["article-cmp-param",w.initCmpParam],["article-quiz-listeners",w.initQuizListeners],["article-rich-links",d.b],["article-tag-rich-link",d.a],["article-upgrade-membership-events",m.a],["article-mediator-emit-event",w.emitReadyEvent],["article-handle-quiz-completion",f.a],["article-opt-in-engagement-banner",w.optInEngagementBanner]])}},813:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(27),o=n.n(i),s=n(41),a=n(23),r=n(73),c=function(e){var t=Object(s.a)("a",e).attr("href");t.match(/https:\/\/membership.theguardian.com/)&&Object(a.a)(t+"/card",{mode:"cors"}).then(function(t){t.html&&o.a.write(function(){Object(s.a)(e).html(t.html).removeClass("element-membership--not-upgraded").addClass("element-membership--upgraded")})}).catch(function(e){Object(r.a)(e,{feature:"membership-events"})})},l=function(){Object(s.a)(".element-membership--not-upgraded").each(c)}},814:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(42),o=n.n(i),s=n(72),a=function(){if(HTMLFormElement.prototype.checkValidity){var e=Array.from(document.getElementsByClassName("js-atom-quiz--instant-reveal"));e.length&&o.a.on(document,"click",e,function e(t){var n=t.currentTarget,i=n.querySelectorAll(":checked + .atom-quiz__answer__item--is-correct").length;if(n.checkValidity()){do{if("break"===function(){var t=n.querySelector(".js-atom-quiz__bucket-message--"+i);if(t)return s.a.write(function(){t.style.display="block"}),o.a.off(document,"click",e),"break";i-=1}())break}while(i>=0)}})}}},815:function(e,t,n){var i;void 0!==(i=function(){function e(t,n,i,o){o=o||0,t(),n>0&&setTimeout(function(){e(t,n-1,i+o,i)},i)}function t(t){setTimeout(function(){e(function(){s(t),a(t)},m,d)},0)}function n(e,t){return e.classList?e.classList.contains(t):-1!==e.className.indexOf(t)}function i(e,t){return e.classList?e.classList.add(t):e.className+=" "+t}function o(e,o){if(o=o||{},"IFRAME"!==e.tagName)throw new Error("Cannot render non-iframe elements!");if(!n(e,l))throw new Error("Cannot render iframes with no "+l+" class!");var s=n(e,u);if(!s||o.force){if(e.style.height=0,e.frameBorder=0,e.style.border="none",e.style.overflow="hidden",e.width="100%",!!e.srcdoc)"complete"===e.contentWindow.document.readyState?t(e):s||e.addEventListener("load",function(){t(e)},!1);else{var a=e.getAttribute("srcdoc");a&&"string"==typeof a&&(e.contentWindow.contents=a,e.src='javascript:window["contents"]',t(e))}i(e,u)}}function s(e){var t=e.contentWindow&&e.contentWindow.document,n=t&&t.body;n&&(n.style.padding=0,n.style.margin=0,n.style.overflow="hidden")}function a(e){var t=e.contentWindow&&e.contentWindow.document;if(t){var n=t.documentElement&&t.documentElement.scrollHeight||t.body&&t.body.scrollHeight||0;e.style.height=n+"px"}}function r(e){var t=document.createElement("div");t.innerHTML=(e||"").trim();var n=t.firstChild,i=n&&"IFRAME"===n.tagName,o=n&&!n.nextSibling;return i&&o}function c(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}var l="fenced",u="fenced-rendered",d=300,m=12;return{render:o,renderAll:function(){for(var e="iframe."+l,t=document.querySelectorAll(e),n=0,i=t.length;n<i;++n)o(t[n])},isSafeCode:r,wrap:function(e){return r(e)?e:'<iframe srcdoc="<html><head></head><body>'+c(e).replace(/\"/g,"&quot;")+'</body></html>" class="'+l+'"></iframe>'}}}.call(t,n,t,e))&&(e.exports=i)},816:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(72),o=function(){i.a.read(function(){return{lastModifiedElm:document.querySelector(".js-lm"),webPublicationDateElm:document.querySelector(".js-wpd")}}).then(function(e){var t=e.lastModifiedElm,n=e.webPublicationDateElm;t&&n&&(i.a.write(function(){n.classList.add("content__dateline-wpd--modified")}),n.addEventListener("click",function(){i.a.write(function(){t.classList.toggle("u-h")})}))})}},817:function(e,t,n){"use strict";n.d(t,"a",function(){return _});var i=n(42),o=n.n(i),s=n(818),a=n.n(s),r=n(41),c=n(0),l=n(22),u=n(7),d=n(194),m=n(29),h=n.n(m),f='\n    <div class="selection-sharing">\n        <ul class="social u-unstyled u-cf" data-component="social-selection">\n            <li class="social__item" data-link-name="twitter">\n                <a  class="rounded-icon social-icon social-icon--twitter js-selection-twitter"\n                    data-link-name="social-selection"\n                    target="_blank"\n                    href="#">\n                    <span class="u-h">Share on Twitter</span>\n                    '+Object(d.a)("shareTwitter",["icon","centered-icon"])+'\n                </a>\n            </li>\n            <li class="social__item" data-link-name="email">\n                <a  class="rounded-icon social-icon social-icon--email js-selection-email"\n                    data-link-name="social-selection"\n                    target="_blank"\n                    href="#">\n                    <span class="u-h">Share via Email</span>\n                    '+Object(d.a)("shareEmail",["icon","centered-icon"])+"\n                </a>\n            </li>\n        </ul>\n    </div>\n",p=r.a.create(f),g=void 0,v=void 0,b=["js-article__body","content__standfirst","block","caption--main","content__headline"],y=function(e){return b.some(function(t){return r.a.ancestor(e.startContainer,t)&&r.a.ancestor(e.endContainer,t)})},w=function(){p.hasClass("selection-sharing--active")&&p.removeClass("selection-sharing--active")},C=function(){p.hasClass("selection-sharing--active")||p.addClass("selection-sharing--active")},j=function(){var e=window.getSelection&&document.createRange&&window.getSelection(),t=document.body;if(t&&e&&e.rangeCount>0&&e.toString()){var n=e.getRangeAt(0),i=a.a.getBoundingClientRect(n);if(!i)return;var o=Object(r.a)(t).scrollTop()+i.top,s=n.toString();if(!y(n))return void w();s.length>114&&(s=s.slice(0,113)+"");var l=encodeURIComponent(s),u=c.a.page.shortUrl+"/stw",d="https://twitter.com/intent/tweet?text=%E2%80%9C"+l+"%E2%80%9D&url="+encodeURI(u),m=encodeURI(c.a.page.webTitle),h=encodeURI(n.toString()),f=c.a.get("page.shortUrl")+"/sbl",b="mailto:?subject="+m+"&body=%E2%80%9C"+h+"%E2%80%9D "+encodeURI(f);g.attr("href",d),v.attr("href",b),p.css({top:o+"px",left:i.left+"px"}),C()}else w()},k=function(e){e.target.closest(".social__item")||w()},_=function(){document.body&&!Object(l.i)()&&(document.body.appendChild(p[0]),g=Object(r.a)(".js-selection-twitter"),v=Object(r.a)(".js-selection-email"),o.a.on(document.body,"keypress keydown keyup",h()(j,50)),o.a.on(document.body,"mouseup",h()(j,200)),o.a.on(document.body,"mousedown",h()(k,50)),u.a.on("window:throttledResize",j))}},818:function(e,t,n){var i,o;/*!
 * RangeFix v0.2.5
 * https://github.com/edg2s/rangefix
 *
 * Copyright 2014-17 Ed Sanders.
 * Released under the MIT license
 */
!function(s,a){void 0!==(o="function"==typeof(i=a)?i.call(t,n,t,e):i)&&(e.exports=o)}(0,function(){function e(){var e,t,n,o,s,a,r,c;return void 0===i&&(t=document.createElement("p"),n=document.createElement("span"),o=document.createTextNode("aa"),s=document.createTextNode("aa"),(a=document.createElement("img")).setAttribute("src","#null"),r=document.createRange(),i={},t.appendChild(o),t.appendChild(n),n.appendChild(a),n.appendChild(s),document.body.appendChild(t),r.setStart(o,1),r.setEnd(n,0),i.getClientRects=i.getBoundingClientRect=r.getClientRects().length>1,i.getClientRects||(r.setEnd(s,1),i.getClientRects=i.getBoundingClientRect=r.getClientRects().length<3),i.getBoundingClientRect||(r.setEnd(r.startContainer,r.startOffset),e=r.getBoundingClientRect(),i.getBoundingClientRect=0===e.top&&0===e.left),document.body.removeChild(t),c=window.ActiveXObject&&new Function("/*@cc_on return @_jscript_version; @*/")(),i.ieZoom=c&&c<=10),i}function t(e){var n;return e?screen.deviceXDPI===screen.logicalXDPI?e:"length"in e?Array.prototype.map.call(e,t):(n=screen.deviceXDPI/screen.logicalXDPI,{top:e.top/n,bottom:e.bottom/n,left:e.left/n,right:e.right/n,width:e.width/n,height:e.height/n}):e}function n(e,t){var n,i=0;if(1024>=t.length)return Array.prototype.push.apply(e,t);for(;i<t.length;)n=Array.prototype.push.apply(e,Array.prototype.slice.call(t,i,i+1024)),i+=1024;return n}var i,o={};return o.getClientRects=function(i){var o,s,a,r,c=e();if(c.ieZoom)return t(i.getClientRects());if(!c.getClientRects)return i.getClientRects();for(o=[],s=i.endContainer,a=i.endOffset,r=document.createRange();s!==i.commonAncestorContainer;)r.setStart(s,0),r.setEnd(s,a),n(o,r.getClientRects()),a=Array.prototype.indexOf.call(s.parentNode.childNodes,s),s=s.parentNode;return(r=i.cloneRange()).setEnd(s,a),n(o,r.getClientRects()),o},o.getBoundingClientRect=function(n){var i,o,s,a,r,c,l=this.getClientRects(n);if(0===l.length)return null;if(r=n.getBoundingClientRect(),(c=e()).ieZoom)return t(r);if(!c.getBoundingClientRect)return r;if(0===r.width&&0===r.height)return l[0];for(i=0,o=l.length;i<o;i++)a=l[i],s?(s.left=Math.min(s.left,a.left),s.top=Math.min(s.top,a.top),s.right=Math.max(s.right,a.right),s.bottom=Math.max(s.bottom,a.bottom)):s={left:a.left,top:a.top,right:a.right,bottom:a.bottom};return s&&(s.width=s.right-s.left,s.height=s.bottom-s.top),s},o})},819:function(e,t,n){"use strict";n.d(t,"a",function(){return g});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(75),c=n.n(r),l=n(76),u=n.n(l),d=n(34),m=n.n(d),h=n(0),f=n(35),p=n(7),g=function(e){function t(){o()(this,t);var e=c()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=h.a.get("page.section"),i=n&&!["info","global"].includes(n);return e.endpoint="/most-read"+(i?"/"+n:"")+".json",p.a.emit("register:begin","popular-in-section"),e.fetch(m()(".js-popular-trails"),"html"),e}return u()(t,e),a()(t,[{key:"ready",value:function(){p.a.emit("modules:popular:loaded"),p.a.emit("register:end","popular-in-section")}}]),t}(f.a)},820:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(33),o=n.n(i),s=n(0),a=n(7),r=n(23),c=n(72),l=n(397),u=n(821),d=function(e){new u.a({dom:e,expanded:!1,showCount:!1}).init()},m=function(){if(!s.a.get("page.keywordIds"))return!1;var e=s.a.get("page.keywordIds","").split(","),t=s.a.get("page.isPaidContent")?e:function(e,t){return[].concat(o()(new Set(e))).filter(function(e){return new Set(t).has(e)})}(["sport/cricket","sport/rugby-union","sport/rugbyleague","sport/formulaone","sport/tennis","sport/cycling","sport/motorsports","sport/golf","sport/horse-racing","sport/boxing","sport/us-sport","sport/australia-sport","football/championsleague","football/premierleague","football/championship","football/europeanfootball","football/world-cup-2014","football/manchester-united","football/chelsea","football/arsenal","football/manchestercity","football/tottenham-hotspur","football/liverpool"],e);return t.length?"/popular-in-tag/"+t[0]+".json":void 0},h=function(e){var t=void 0,n=void 0,i=void 0;if(s.a.get("page.hasStoryPackage")){var u=document.body&&document.body.querySelector(".related-trails");u&&d(u)}else if(s.a.get("switches.relatedContent")&&s.a.get("page.showRelatedContent")){var h=document.body&&document.body.querySelector(".js-related");if(h&&!h.classList.contains("lazyloaded")){n=m(),i=n?"related-popular-in-tag":"related-content",Object(l.a)(i),h.setAttribute("data-component",i),t=n||"/related/"+s.a.get("page.pageId")+".json";var f=e.excludeTags.map(function(e){return"exclude-tag="+e});e.excludeTags&&e.excludeTags.length&&(t+="?"+f.join("&")),Object(r.a)(t,{mode:"cors"}).then(function(e){return c.a.write(function(){h.innerHTML=e.html,h.classList.add("lazyloaded")})}).then(function(){var e=h.querySelector(".related-content");e&&d(e),a.a.emit("modules:related:loaded",h),Object(l.b)(i)}).catch(function(){h.remove(),Object(l.c)(i)})}}else[].concat(o()(document.querySelectorAll(".js-related"))).forEach(function(e){return e.classList.add("u-h")})}},821:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=function(){function e(t){o()(this,e),this.opts=t,this.dom=t.dom,this.expanded=!1!==t.expanded,this.cta=document.createElement("button"),this.showCount=!1!==t.showCount}return a()(e,[{key:"renderState",value:function(){this.expanded?this.dom.classList.remove("shut"):this.dom.classList.add("shut")}},{key:"getCount",value:function(){return parseInt(this.dom.getAttribute("data-count")||"0",10)}},{key:"updateCallToAction",value:function(){var e="Show "+(this.showCount?this.getCount()+" ":"")+(this.expanded?"fewer":"more");this.cta.innerHTML=e,this.cta.setAttribute("data-link-name","Show "+(this.expanded?"more":"fewer")),this.cta.setAttribute("data-is-ajax","1")}},{key:"toggleExpanded",value:function(){this.expanded=!this.expanded,this.renderState(),this.updateCallToAction()}},{key:"isOpen",value:function(){return!this.dom.classList.contains("shut")}},{key:"renderCallToAction",value:function(){var e=this;this.cta.addEventListener("click",function(){e.toggleExpanded()}),this.cta.className="cta",this.opts.buttonAfterEl?this.opts.buttonAfterEl.insertAdjacentElement("afterend",this.cta):this.dom.appendChild(this.cta),this.updateCallToAction()}},{key:"scrollToCallToAction",value:function(){var e=this;this.expanded||window.setTimeout(function(){e.cta.scrollIntoView()},550)}},{key:"init",value:function(){this.dom.classList.contains("expandable-initialised")||!this.dom.innerHTML||this.getCount()<3||(this.dom.classList.add("expandable-initialised"),this.renderCallToAction(),this.renderState())}},{key:"toggle",value:function(){this.toggleExpanded()}}]),e}()},822:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var i=n(11),o=n.n(i),s=n(75),a=n.n(s),r=n(13),c=n.n(r),l=n(76),u=n.n(l),d=n(0),m=n(7),h=n(397),f={uk:{features:"uk-alpha/features/feature-stories",comment:"uk-alpha/contributors/feature-stories"},us:{features:"us-alpha/features/feature-stories",comment:"us-alpha/contributors/feature-stories"},au:{features:"au-alpha/features/feature-stories",comment:"au-alpha/contributors/feature-stories"},int:{features:"22167321-f8cf-4f4a-b646-165e5b1e9a30",comment:"ee3386bb-9430-4a6d-8bca-b99d65790f3b"}},p=function(e){function t(){o()(this,t);var e=a()(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object(h.a)("tonal-content"),e.edition=d.a.get("page.edition","").toLowerCase(),e.isSupported()&&(e.endpoint=e.getEndpoint()),e}return u()(t,e),c()(t,null,[{key:"getTone",value:function(){return d.a.get("page.tones","").split(",")[0].toLowerCase()}},{key:"ready",value:function(){m.a.emit("modules:tonal:loaded"),Object(h.b)("tonal-content")}},{key:"error",value:function(){Object(h.c)("tonal-content")}}]),c()(t,[{key:"getEndpoint",value:function(){return"/container/"+f[this.edition][t.getTone()]+".json"}},{key:"isSupported",value:function(){return t.getTone()in f[this.edition]}}]),t}(n(35).a)},823:function(e,t,n){"use strict";n.d(t,"a",function(){return x});var i=n(27),o=n.n(i),s=n(73),a=n(41),r=n(23),c=n(0),l=n(469),u=n(105),d=n.n(u),m=n(194),h=n(824),f=n.n(h),p=n(825),g=n.n(p),v=Object(a.a)(".js-sharecount"),b={facebook:"n/a"},y=0,w=void 0,C=void 0,j=function(e){if(0!==e){y+=e;var t=parseInt(y.toFixed(0),10),n=Object(l.a)(t),i=t>1e4?Math.round(t/1e3)+"k":t;o.a.write(function(){w.text(n),C.text(i)})}},k=function(){v.attr("title",d()("Facebook: <%=facebook%>",b))},_=function(e){var t=Object(m.a)("share"),n=v.hasClass("js-sharecount-immersive")?g.a:f.a,i=d()(n,{icon:t});v.removeClass("u-h").html(i).css("display",""),C=Object(a.a)(".sharecount__value--short",v[0]),w=Object(a.a)(".sharecount__value--full",v[0]),j(e)},O=function(){var e=c.a.page.ajaxUrl+"/sharecount/"+c.a.page.pageId+".json";Object(r.a)(e,{mode:"cors"}).then(function(e){var t=e.share_count||0;b.facebook=t,_(t),k()})},x=function(){if(c.a.switches.serverShareCounts&&v.length&&!c.a.page.isPreview)try{O()}catch(e){Object(s.a)(new Error("Error retrieving share counts ("+e.message+")"),{feature:"share-count"},!1)}}},824:function(e,t){e.exports='<h3 class="sharecount__heading"><%=icon%><span class="sharecount__text u-h">Shares</span></h3>\n<div class="sharecount__value sharecount__value--full">0</div>\n<div class="sharecount__value sharecount__value--short">0</div>\n'},825:function(e,t){e.exports='<%= icon %><span class="sharecount__value sharecount__value--short">0</span> Shares\n'},826:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(42),o=n.n(i),s=n(0),a=n(35),r=function(e){return Boolean(s.a.page.seriesTags)?"/video/in-series/"+s.a.page.seriesId+".json":"/"+(s.a.page.isPodcast?"podcast":e)+"/most-viewed.json"},c=function(e,t,n,i){var o=new a.a;return o.manipulationType=n,o.endpoint=t+(i?"?page="+i:""),e.innerHTML="",o.fetch(e,"html")},l=function(e,t,n){o.a.on(e,"click",".most-viewed-navigation__button",function(i){var o=i.target.getAttribute("data-page");return c(e,n,t,o),i.preventDefault(),!1})},u=function(e,t){var n="video"===t?"append":"html",i=r(t);c(e,i,n).then(function(){l(e,n,i)})}},827:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i=n(35),o=n(7),s=n(225),a=function(e,t,n,a,r){var c=new i.a,l="/"+t+"/section/"+n+(r?"/"+r:"")+".json?shortUrl="+a+("video"===t?"&exclude-tag=guardian-professional/guardian-professional":"");c.endpoint=l,c.fetch(e).then(function(){Object(s.a)([e]),o.a.emit("page:media:moreinloaded",e)})}},828:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var i=n(96),o=n(470),s=n(0),a=new URL(window.location.href).searchParams.get("utm_medium"),r={title:"You have to update your email settings",cta:"Update them now ",link:s.a.page.idUrl+"/consents"},c='\n    <div id="site-message__message">\n        <div class="site-message__message site-message__message--gdpr-opt-in">\n            <div class="gdpr-opt-in__message-text">\n                '+r.title+'\n            </div>\n            <a target="_blank" href="'+r.link+'" data-link-name="gdrp-opt-in : banner-click">\n                '+r.cta+"\n            </a>\n        </div>\n    </div>",l=function(){return new Promise(function(e){if(null===a||"email"!==a.toLowerCase())return e(!1);Object(i.b)(function(t){e(null!==t&&t.statusFields.hasRepermissioned?!1:!0)})})},u=function(){l().then(function(e){e&&new o.a("gdpr-opt-in-jan-18",{important:!0}).show(c)})}},829:function(e,t){e.exports='<li class="<%=articleType%>-lightbox__item <%=articleType%>-lightbox__item--img js-<%=articleType%>-slide">\n    <div class="<%=articleType%>-lightbox__img-container"><img class="<%=articleType%>-lightbox__img js-<%=articleType%>-lightbox-img"></div>\n    <div class="<%=articleType%>-lightbox__info js-<%=articleType%>-lightbox-info">\n        <div class="<%=articleType%>-lightbox__progress <%=articleType%>-lightbox__progress--info">\n            <span class="<%=articleType%>-lightbox__index"><%=index%></span>\n            <span class="<%=articleType%>-lightbox__progress-separator"></span>\n            <span class="<%=articleType%>-lightbox__count"><%=count%></span>\n            </div>\n        <div class="<%=articleType%>-lightbox__img-caption"><%=caption%></div>\n        <div class="<%=articleType%>-lightbox__img-credit"><%=credit%></div>\n        <div class="block-share block-share--<%=articleType%> hide-on-mobile" data-link-name="block share">\n            <%=shareButtons%>\n        </div>\n        <div class="block-share--<%=articleType%>-mobile" data-open-overlay-on-click="share-modal-<%=index%>" data-link-name="open mobile block share">\n            <button class="block-share__item--mobile button button--small button--tone-media-variant mobile-only">\n                Share\n            </button>\n        </div>\n    </div>\n    <div id="share-modal-<%=index%>" class="overlay share-modal overlay--<%=articleType%> js-share-modal">\n        <div class="share-modal__content" data-link-name="mobile block share">\n            <div class="share-modal__title">Share this post</div>\n            <%=shareButtonsMobile%>\n            <button class="share-modal__close js-overlay-close" data-link-name="close"><i class="i i-close-icon-dark-small"></i><span class="u-h">close</span></button>\n        </div>\n    </div>\n</li>\n'},830:function(e,t){e.exports='<div class="gallery-lightbox__btn gallery-lightbox__btn--<%=label%> js-gallery-<%=label%>">\n<button data-link-name="gallery-lightbox <%=label%>" class="gallery-lightbox__btn-body"><i></i><%=label%></button>\n</div>'},831:function(e,t){e.exports='<li class="gallery-lightbox__item gallery-lightbox__item--endslate js-gallery-slide">\n<div class="gallery-lightbox__endslate js-gallery-endslate fc-container--media"></div>\n</li>'},832:function(e,t){e.exports='<div class="pamplemousse gallery-lightbox__loader js-loader">\n<div class="pamplemousse__pip"><i></i></div>\n<div class="pamplemousse__pip"><i></i></div>\n<div class="pamplemousse__pip"><i></i></div>\n</div>'},833:function(e,t){e.exports='<a class="rounded-icon block-share__item block-share__item--<%=css%> js-blockshare-link" href="<%=url%>" target="_blank" data-link-name="social <%=css%>">\n    <span class="u-h"><%=text%></span>\n    <%= icon %>\n</a>\n'},834:function(e,t){e.exports='<a class="share-modal__link" href="<%=url%>" target="_blank" data-link-name="social <%=css%>">\n    <div class="share-modal__item button button--xlarge share-modal__item--<%=css%>">\n        <%= icon %>\n        <%=text%>\n    </div>\n</a>\n'},938:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"init",function(){return g});var i=n(0),o=n(22),s=n(7),a=n(556),r=n(939),c=n(940),l=n(398),u=n(499),d=n(424),m=n(192),h=function(){var e=i.a.get("page.keywordIds","");!Object(o.l)({min:"desktop"})||e.includes("football/football")||e.includes("sport/rugby-union")||new r.a({element:document.querySelector(".js-live-blog__sticky-components-container"),topMarker:document.querySelector(".js-top-marker"),bottomMarker:document.querySelector(".js-bottom-marker"),containerElement:document.querySelector(".js-live-blog__sticky-components")})},f=function(){i.a.get("page.isLive")&&Object(c.a)()},p=function(){window.setInterval(function(){return Object(l.a)()},6e4)},g=function(){Object(m.b)([["lb-autoupdate",f],["lb-timeline",h],["lb-timestamp",p],["lb-richlinks",a.b]]),Object(d.initTrails)(),Object(u.a)(),Object(m.b)([["lb-ready",function(){s.a.emit("page:liveblog:ready")}]])}},939:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i=n(11),o=n.n(i),s=n(13),a=n.n(s),r=n(16),c=n.n(r),l=n(7),u=n(72),d=function(e){return"auto"!==e?parseInt(e,10):0},m=function(){function e(t){var n=this;o()(this,e),window.addEventListener("click",function(){n.checkPosition()}),l.a.addListener("window:throttledScroll",function(){n.checkPosition()}),l.a.addListener("window:throttledResize",function(){n.calculateContainerPositioning()}),this.affixed=!1,this.$markerTop=c()(t.topMarker),this.$markerBottom=c()(t.bottomMarker),this.$container=c()(t.containerElement),this.$element=c()(t.element),this.$window=c()(document.body),this.checkPosition(),this.calculateContainerPositioning()}return a()(e,[{key:"calculateContainerPositioning",value:function(){var e=this;u.a.write(function(){e.$container.css("top","0")}).then(function(){return u.a.read(function(){return e.$markerTop.offset().top-e.$container.offset().top})}).then(function(t){u.a.write(function(){e.$container.css("top",t+"px")})})}},{key:"checkPosition",value:function(){var e=this,t=this.$window.scrollTop(),n=this.$markerTop.offset().top,i=this.$markerBottom.offset().top,o=this.$element.dim().height,s=t>=n,a=t+o<i,r=o<c.a.viewport().height,l=a&&s&&r;if(this.affixed!==l){if(this.affixed=l,a)u.a.write(function(){e.$container.removeClass("affix-bottom")}),this.calculateContainerPositioning();else{var m=i-n-o+d(this.$container.css("top"));u.a.write(function(){e.$container.css("top",m+"px"),e.$container.addClass("affix-bottom")})}u.a.write(function(){l?e.$element.addClass("affix"):e.$element.removeClass("affix")})}}}]),e}()},940:function(e,t,n){"use strict";n.d(t,"a",function(){return j});var i=n(33),o=n.n(i),s=n(42),a=n.n(s),r=n(16),c=n.n(r),l=n(34),u=n.n(l),d=n(41),m=n(72),h=n(23),f=n(22),p=n(7),g=n(557),v=n(407),b=n(221),y=n(398),w=n(941),C=n(225),j=function(e){var t=Object.assign({toastOffsetTop:12,minUpdateDelay:1e3*(Object(f.l)({min:"desktop"})?10:30),maxUpdateDelay:12e5,backoffMultiplier:.75},e),n=Object(d.a)(".js-liveblog-body"),i=Object(d.a)(".toast__button"),s=Object(d.a)(".toast__text",i),r=u()(".toast__container")[0],l=t.minUpdateDelay,j=n.data("most-recent-block"),k=0,_=void 0,O=function(e){var n=void 0;n=Object(f.o)()?t.minUpdateDelay:Math.min(1.5*e,t.maxUpdateDelay),l=n},x=function(){return n.offset().top<window.pageYOffset},E=!window.location.search.includes("?page="),T=function(){m.a.write(function(){Object(d.a)(".autoupdate--hidden",n).addClass("autoupdate--highlight").removeClass("autoupdate--hidden"),p.a.emit("modules:autoupdate:unread",0)})},S=function(){m.a.write(function(){if(k>0){var e=k>1?" new updates":" new update";i.removeClass("toast__button--closed"),Object(d.a)(r).addClass("toast__container--open"),s.html(k+e)}else i.removeClass("loading").addClass("toast__button--closed"),Object(d.a)(r).removeClass("toast__container--open")})},P=function(e){var t=d.a.create("<div>"+e+"</div>")[0],i=void 0;m.a.write(function(){c()(t.children).addClass("autoupdate--hidden"),i=[].concat(o()(t.children)),n.prepend(i),p.a.emit("modules:autoupdate:updates",i.length),Object(y.a)(),Object(g.a)(),Object(C.a)(i)})},A=function(){Object(f.o)()&&T(),k=0,S()},I=function e(){void 0!==_&&clearTimeout(_);var t=0,n="?lastUpdate="+(j||"block-0")+("&isLivePage="+(E?"true":"false")),i=window.location.pathname+".json"+n,o=function(){0===t||l>0?(O(l),_=setTimeout(e,l)):_=setTimeout(e,1)};return Object(h.a)(i,{mode:"cors"}).then(function(e){(t=e.numNewBlocks)>0&&(k+=t,p.a.emit("modules:autoupdate:unread",k),j=e.mostRecentBlockId,E?(P(e.html),x()?S():A()):S()),o()}).catch(function(){o()})};Object(w.a)(),new v.a(r,{top:t.toastOffsetTop,emitMessage:!0,containInParent:!1}).init(),I(),Object(f.j)(),a.a.on(document.body,"click",".toast__button",function(){E?m.a.read(function(){Object(b.b)(u()(".blocks")[0],300,"easeOutQuad"),m.a.write(function(){i.addClass("loading")}).then(function(){A()})}):window.location.assign(window.location.pathname)}),p.a.on("modules:toast__tofix:unfixed",function(){E&&k>0&&m.a.write(function(){i.addClass("loading")}).then(function(){A()})}),p.a.on("modules:detect:pagevisibility:visible",function(){0===k&&T(),l=0,I()}),m.a.write(function(){n.addClass("autoupdate--has-animation")})}},941:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(7),o=function(e,t){document.title=e>0?"("+e+") "+t:t},s=function(){var e=document.title;i.a.on("modules:autoupdate:unread",function(t){o(t,e)})}},942:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"init",function(){return a});var i=n(499),o=n(424),s=n(943),a=function(){Object(i.a)(),Object(o.initTrails)(),Object(s.a)()}},943:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var i=n(33),o=n.n(i),s=n(41),a=n(72),r=n(7),c=n(22),l=function(e){return a.a.write(function(){e.$el.css("height","")}).then(function(){if(e.isMobile)return a.a.read(function(){return e.$el.height()}).then(function(t){return a.a.write(function(){e.$el.css("height",t)})})})},u=function(e){e.elements.forEach(function(t){l({$el:Object(s.a)(t),isMobile:e.isMobile})})},d=function(){return a.a.read(function(){return{elements:[].concat(o()(document.getElementsByClassName("js-is-fixed-height"))),isMobile:"mobile"===Object(c.c)()}})},m=function(){d().then(u)},h=function(){r.a.on("window:throttledResize",m),r.a.on("window:orientationchange",m),m()}},944:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"init",function(){return l});var i=n(34),o=n.n(i),s=n(0),a=n(35),r=n(424),c=function(){var e=new a.a,t=o()(".js-gallery-most-popular")[0];e.manipulationType="html",e.endpoint="/gallery/most-viewed.json",e.fetch(t,"html")},l=function(){Object(r.initTrails)(),s.a.get("page.showRelatedContent")&&c()}}});
//# sourceMappingURL=graun.article.js.map